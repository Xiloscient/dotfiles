"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8],{56877:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});var n=i(98135),o=i.n(n),s=i(59713),r=i.n(s),a=(i(33948),i(67294)),l=i.n(a),c=i(62727),d=i(33846),h=i(66832),u=i(3779),m=i(24677),p=i(98104),b=i(56109),g=i(87953),y=i(41101),v=i(5366);class S extends h.Z{constructor(...e){super(...e),r()(this,"storeTypes",{store:d.Z}),r()(this,"handleFocused",(()=>{m.ZH(this.environment),p.ZH(this.environment),this.stores.store.setState({...this.stores.store.state,focus:!0})})),r()(this,"handleBlurred",(()=>{this.stores.store.setState({...this.stores.store.state,focus:!1})})),r()(this,"handleSearchQueryChange",(e=>{this.props.onChange({searchQuery:e.target.value})}))}renderComponent(){const{searchQuery:e,intl:t}=this.props,{focus:i}=this.stores.store.state;return o()(b.Z,{capture:i},void 0,o()(g.Z,{capture:!0,render:n=>l().createElement("div",n,o()(c.Z,{style:this.getStyle(),format:c.B.Transparent,value:e,placeholder:t.formatMessage({defaultMessage:"Type to searchâ€¦",id:"database.mobileSearch.placeholder"}),onChange:this.handleSearchQueryChange,autoComplete:"on",autoCorrect:"on",onFocus:this.handleFocused,onBlur:this.handleBlurred,showClearButton:!0,left:u.Z.searchThick(this.getSearchIconStyle())}),o()(y.Z,{show:i}))}))}getStyle(){return{boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,flexGrow:0,flexShrink:0,height:32,paddingLeft:8,paddingRight:12,borderRadius:3,fontSize:14,marginBottom:4}}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}}const f=(0,v.injectIntl)(S)},44299:(e,t,i)=>{i.r(t),i.d(t,{default:()=>E});var n=i(67154),o=i.n(n),s=i(98135),r=i.n(s),a=i(59713),l=i.n(a),c=(i(33948),i(67294)),d=i.n(c),h=i(96486),u=i.n(h),m=i(3779),p=i(44886),b=i(55332),g=i(24677),y=i(50906),v=i(82990),S=i(66832),f=i(40464),k=i(73383),M=i(82945),T=i(16961),C=i(98104),w=i(15692),x=i(80935),A=i(27724),B=i(24666),I=i(17903),Z=i(14947),P=i(64131),R=i(5366),F=i(32404),O=i(17215),D=i(72653),N=i(85394),U=i(52533),L=i(67074),_=i(74350),q=i(69454),V=i(59488);class W extends S.Z{constructor(...e){super(...e),l()(this,"scrollerDiv",void 0),l()(this,"currentlyShownTimer",void 0),l()(this,"previouslyShownOnNative",!1),l()(this,"handleScrollerRef",(e=>{e&&(this.scrollerDiv=e)})),l()(this,"handleUnindent",(e=>{L.$$(this.environment)})),l()(this,"handleIndent",(e=>{L.O2(this.environment)})),l()(this,"handleMoveUp",(e=>{L.s0(this.environment)})),l()(this,"handleMoveDown",(e=>{L.rZ(this.environment)})),l()(this,"handleUndo",(()=>{L.i2(this.environment)})),l()(this,"handleRedo",(()=>{L.GH(this.environment)})),l()(this,"handleDismissKeyboard",(e=>{g.ZH(this.environment),this.props.stores.store.setState({...this.props.stores.store.state,isInsertOpen:!1}),this.trackItemTap("hide_keyboard"),C.sD()})),l()(this,"handleInsert",(e=>{this.props.stores.store.setState({...this.props.stores.store.state,isInsertOpen:!0}),this.trackItemTap("insert")})),l()(this,"handleTakePicture",(e=>{L.vs(this.environment)})),l()(this,"handleMention",(e=>{L.Z3(this.environment)})),l()(this,"handleComment",(e=>{L.ol(this.environment,!1)})),l()(this,"handleDelete",(e=>{L.fn(this.environment)})),l()(this,"handleActionsScroll",(()=>{y.FGU(this.environment)})),l()(this,"handleActionsScrollDebounced",u().debounce(this.handleActionsScroll,500)),l()(this,"handleMoreClick",(e=>{L.w1(this.environment,e.clientX,e.clientY)})),l()(this,"listenForPositionChanges",this.createComputedStore((()=>{const e=B.default.state,t="editing"===e.mode&&e.multiSelection;return t?{scrollTop:I.Z.state.scrollTop,editing:!0,store:t.end.store.id,selection:t.end}:{scrollTop:I.Z.state.scrollTop,editing:!1}}))),l()(this,"renderStore",this.createComputedStore((()=>{var e;return L.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)}))),l()(this,"shouldShowTextActions",this.createComputedStore((()=>L.oQ(this.props.stores.ignoreSelectionAreaStore)))),l()(this,"shouldShowBlockActions",this.createComputedStore((()=>!this.shouldShowTextActions.state))),l()(this,"canTriggerBlockActions",this.createComputedStore((()=>!!this.shouldShowBlockActions.state&&L.Bo(this.pageContext&&this.pageContext.publicEditModeStore.state)))),l()(this,"canTriggerTextActions",this.createComputedStore((()=>L.eQ(this.pageContext&&this.pageContext.publicEditModeStore.state,this.props.currentBlockStore))))}willMountOrUpdate(){const{device:e}=this.environment,t=this.renderStore.state.shouldShow;if(e.isMobileBrowser){const e=this.props.stores.store.state.isOpen;t?e?void 0!==this.currentlyShownTimer&&(window.clearTimeout(this.currentlyShownTimer),this.currentlyShownTimer=void 0):(this.props.stores.store.setState({...this.props.stores.store.state,isOpen:!0}),this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0)):e&&void 0===this.currentlyShownTimer&&(this.currentlyShownTimer=window.setTimeout((()=>{this.currentlyShownTimer=void 0,this.props.stores.store.setState({...this.props.stores.store.state,isOpen:!1})}),200))}else t!==this.previouslyShownOnNative&&(this.previouslyShownOnNative=t,this.scrollerDiv&&(this.scrollerDiv.scrollLeft=0))}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,i=this.isOpen(),n=e.isMobile&&D.Z.state;if(this.props.position===U.n.Bottom){let e=0;return(0,V.de)()?e=q.Z.estimatedKeyboardWebViewOverlap():n&&(e=t.getSafePaddingBottomCSS(N.default.height)),r()("div",{style:{position:"absolute",bottom:e,left:0,height:W.height,width:"100%",pointerEvents:i?"auto":"none",opacity:i?1:0,transform:i?"translateY(0)":"translateY(".concat(W.height,"px)"),transition:"opacity 120ms ease-out, transform 120ms ease-out"}},void 0,this.renderActionButtons())}{const e=this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionRect||x.getSelectionRect();if(!e)return;const t=document.body.getBoundingClientRect(),n={...e,left:10,top:e.top+10-t.top};this.listenForPositionChanges.state;const{device:o}=this.environment;return r()(w.ZP,{popupType:o.isMobileNative?w.ZP.PopupType.SlideUp:w.ZP.PopupType.Popup,open:i,preventBlockRenderQueueOnEnter:!0,placementToOrigin:w.ZP.Placement.Bottom,alignmentToOrigin:w.ZP.Alignment.Start,originRect:n,disableMouseCapture:!0,keepFocus:!0,render:()=>r()("div",{style:{height:W.height,width:"calc(80wv)",borderRadius:3,overflow:"hidden"}},void 0,this.renderActionButtons())})}}renderActionButtons(){const e=this.shouldShowTextActions.state,t=this.shouldShowBlockActions.state,i=L.Tz({environment:this.environment,store:this.props.currentBlockStore});return r()("div",{style:this.getActionButtonStyles()},void 0,i&&this.renderTemplatesButton(),!i&&t&&this.renderBlockActions(),!i&&e&&this.renderTextActions(),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),borderLeft:this.getItemBorder(),borderRight:"none"},onClick:this.handleDismissKeyboard},void 0,W.keyboardIcon))}renderBlockActions(){const e=this.canTriggerBlockActions.state;let t=!1,i=!1;const n=this.props.currentBlockStore.getValue();n&&((0,O._T)(n)||(t=!0),(0,O.lQ)(n)||(i=!0));const{device:s}=this.environment;return d().createElement("div",{ref:this.handleScrollerRef,style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),...!s.isSmallPhone&&{paddingLeft:12,paddingRight:12}},onClick:this.handleInsert,disabled:!e},void 0,W.plusIcon,this.renderChevronDown()),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:v.Z.fontWeight.medium},onClick:e=>{this.props.stores.store.setState({...this.props.stores.store.state,isTurnIntoOpen:!0}),this.trackItemTap("turn_into")},disabled:!e},void 0,r()(R.FormattedMessage,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.buttonTitle"}),this.renderChevronDown()),r()(T.Z,{capture:!0,render:e=>d().createElement(Z.Z,o()({mobileFeedback:!0,disabledFeedback:!0},e,{style:this.getItemStyle(),onClick:this.handleMention,disabled:!i}),r()("span",{style:{fontSize:19,lineHeight:1,fontWeight:v.Z.fontWeight.medium,marginBottom:s.isAndroid?4:0}},void 0,"@"))}),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleComment,disabled:!t},void 0,W.discussionIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleTakePicture,disabled:!e},void 0,W.imageIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:this.getItemStyle(),onClick:this.handleDelete,disabled:!e},void 0,W.trashIcon),this.renderBlockMovementActions(),this.renderBlockUndoActions(),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:v.Z.fontWeight.medium},onClick:e=>{this.props.stores.store.setState({...this.props.stores.store.state,isColorOpen:!0}),this.trackItemTap("color")},disabled:!e},void 0,r()(R.FormattedMessage,{defaultMessage:"Color",id:"mobileActionBar.color.buttonTitle"}),this.renderChevronDown()),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),fontWeight:v.Z.fontWeight.medium},onClick:this.handleMoreClick,disabled:!e},void 0,r()(R.FormattedMessage,{defaultMessage:"More",id:"mobileActionBar.more.buttonTitle"}),this.renderChevronDown()))}renderBlockMovementActions(){const e=this.canTriggerBlockActions.state,t=A.default.state.stores[0];return r()("div",{style:{...this.getItemStyle(),paddingLeft:6,paddingRight:6}},void 0,r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:W.minorItemStyle,disabled:!e||!p.gq(t),onClick:this.handleUnindent},void 0,W.unindentIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:W.minorItemStyle,disabled:!e||!p.nt(t),onClick:this.handleIndent},void 0,W.indentIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:W.minorItemStyle,disabled:!e,onClick:this.handleMoveUp},void 0,W.moveUpIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:W.minorItemStyle,disabled:!e,onClick:this.handleMoveDown},void 0,W.moveDownIcon))}renderBlockUndoActions(){return r()("div",{style:{...this.getItemStyle(),paddingLeft:6,paddingRight:6}},void 0,r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:W.minorItemStyle,disabled:!b.L0(),onClick:this.handleUndo},void 0,W.undoIcon),r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:W.minorItemStyle,disabled:!b.AZ(),onClick:this.handleRedo},void 0,W.redoIcon))}renderTextActions(){const e=this.canTriggerTextActions.state,t=this.props.currentBlockStore.canComment();return r()("div",{style:this.getActionMenuStyle(),onScroll:this.handleActionsScrollDebounced},void 0,r()(M.Z,{style:this.getItemStyle(),blockStore:A.default.state.stores[0],disabled:!t}),r()(f.Z,{type:"b",style:this.getItemStyle(),onClick:()=>this.trackItemTap("bold"),disabled:!e},void 0,r()("span",{style:{fontWeight:v.Z.fontWeight.semibold}},void 0,r()(R.FormattedMessage,{defaultMessage:"B",id:"mobileActionBar.bold.symbol",description:"Letter 'B' which represents 'bold' format option."}))),r()(f.Z,{type:"i",style:this.getItemStyle(),onClick:()=>this.trackItemTap("italic"),disabled:!e},void 0,r()("span",{style:{fontStyle:"italic",fontWeight:v.Z.fontWeight.semibold}},void 0,r()(R.FormattedMessage,{defaultMessage:"i",id:"mobileActionBar.italic.symbol",description:"Letter 'i' which represents 'italic' format option."}))),r()(f.Z,{type:"_",style:this.getItemStyle(),onClick:()=>this.trackItemTap("underline"),disabled:!e},void 0,r()("span",{style:{textDecoration:"underline"}},void 0,r()(R.FormattedMessage,{defaultMessage:"U",id:"mobileActionBar.underline.symbol",description:"Letter 'U' which represents 'underline' format option."}))),r()(f.Z,{type:"s",style:this.getItemStyle(),onClick:()=>this.trackItemTap("strike_through"),disabled:!e},void 0,r()("span",{style:{textDecoration:"line-through"}},void 0,r()(R.FormattedMessage,{defaultMessage:"S",id:"mobileActionBar.strikeThrough.symbol",description:"Letter 'S' which represents 'strike-through' format option."}))),r()(f.Z,{type:"c",style:this.getItemStyle(),onClick:()=>this.trackItemTap("code"),disabled:!e},void 0,r()("span",{style:{fontFamily:v.Z.getCompositeFontFamily(_.SP).githubMono}},void 0,r()(R.FormattedMessage,{defaultMessage:"Code",id:"mobileActionBar.code.symbol",description:"Word 'code' which represents 'code' format option."}))),r()(k.Z,{style:this.getItemStyle(),disabled:!e},void 0,r()("span",{style:{borderBottom:"1px solid ".concat(this.theme.linkDecorationColor)}},void 0,r()(R.FormattedMessage,{defaultMessage:"Link",id:"mobileActionBar.link.symbol",description:"Word 'link' which represents 'link' format option."}))),r()(F.Z,{onClick:()=>this.trackItemTap("equation"),disabled:!e,style:this.getItemStyle()},void 0,m.Z.equation({width:16,height:16})),r()(P.Z,{style:this.getItemStyle(),ignoreSelectionAreaStore:this.props.stores.ignoreSelectionAreaStore,disabled:!e}))}renderTemplatesButton(){return r()("div",{style:this.getActionMenuStyle()},void 0,r()(Z.Z,{mobileFeedback:!0,disabledFeedback:!0,style:{...this.getItemStyle(),borderRight:"none",fontWeight:v.Z.fontWeight.medium},onClick:e=>{this.props.stores.store.setState({...this.props.stores.store.state,isTemplatesOpen:!0}),this.trackItemTap("templates")}},void 0,m.Z.templatesColor({width:20,marginRight:8}),r()(R.FormattedMessage,{defaultMessage:"Choose a template...",id:"mobileActionBar.templates.buttonTitle"}),this.renderChevronDown()))}renderChevronDown(){return m.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})}isOpen(){const{device:e}=this.environment;return e.isMobileBrowser?this.props.stores.store.state.isOpen:this.renderStore.state.shouldShow}trackItemTap(e){y.YOV(this.environment,{itemName:e})}getItemBorder(){return"1px solid ".concat(this.theme.regularDividerColor)}getActionButtonStyles(){const{device:e,WindowSizeStore:t}=this.environment;return{height:"100%",width:"100%",fontSize:15,display:"flex",boxShadow:this.props.position===U.n.Bottom?this.theme.bottomActionBarShadow:this.theme.mediumBoxShadow,backgroundColor:this.theme.keyboardActionBarBackground,paddingLeft:e.isMobileNative?t.state.paddingLeftCSS:0,paddingRight:e.isMobileNative?t.state.paddingRightCSS:0}}getActionMenuStyle(){return{flexGrow:1,flexShrink:1,marginRight:-1,display:"flex",overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch"}}getItemStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:e.isSmallPhone?8:10,paddingRight:e.isSmallPhone?8:10,borderRight:this.getItemBorder(),whiteSpace:"nowrap",height:W.height,flexShrink:0,flexGrow:0,flexBasis:"auto",color:this.theme.regularTextColor,minWidth:e.isSmallPhone?42:44}}}l()(W,"unindentIcon",m.Z.indentDown({width:18,height:18,transform:"rotate(90deg)",position:"relative",left:1})),l()(W,"indentIcon",m.Z.indentDown({width:18,height:18,transform:"rotate(-90deg)",position:"relative",left:-1})),l()(W,"moveUpIcon",m.Z.moveUp({width:18,height:18,position:"relative",left:2})),l()(W,"moveDownIcon",m.Z.moveUp({width:18,height:18,transform:"rotate(180deg)",position:"relative",left:2})),l()(W,"undoIcon",m.Z.undo({width:19,height:19})),l()(W,"redoIcon",m.Z.redo({width:19,height:19})),l()(W,"trashIcon",m.Z.trash({width:18,height:18})),l()(W,"discussionIcon",m.Z.speechBubbleThin({width:18,height:18})),l()(W,"plusIcon",m.Z.thinPlus({width:14,height:14})),l()(W,"keyboardIcon",m.Z.keyboard({width:18,height:18})),l()(W,"imageIcon",m.Z.image({width:18,height:18})),l()(W,"height",42),l()(W,"minorItemStyle",{width:34,justifyContent:"center"});const E=(0,R.injectIntl)(W)},82043:(e,t,i)=>{i.r(t),i.d(t,{default:()=>L});var n=i(98135),o=i.n(n),s=i(67154),r=i.n(s),a=i(59713),l=i.n(a),c=(i(33948),i(67294)),d=i.n(c),h=i(50906),u=i(7313),m=i(52016);class p extends m.Z{getInitialState(){return{isOpen:!1,isInsertOpen:!1,isTurnIntoOpen:!1,isColorOpen:!1,isTemplatesOpen:!1}}}const b=p;var g=i(52858),y=i(95009),v=i(66832),S=i(52377),f=i(16961),k=i(51454),M=i(15692),T=i(27724),C=i(24666),w=i(63334),x=i(5366),A=i(29798),B=i(25584),I=i(94006),Z=i(94660),P=i(34574),R=i(70442),F=i(21325),O=i(83071),D=i(15282),N=i(67074);class U extends v.Z{constructor(...e){super(...e),l()(this,"storeTypes",{store:b,ignoreSelectionAreaStore:w.Z,templatePickerMenuListStore:A.Z}),l()(this,"renderMobileTemplatePreviewItem",(e=>({key:e.name,render:t=>d().createElement(P.Z,r()({},t,{key:e.name,title:e.name,type:"page_template",format:"phone-modal",emoji:e.emoji,locked:!1})),action:()=>{R.$7({environment:this.environment,item:e,createNewPage:!1,isPrivate:!1})}}))),l()(this,"renderPageTemplatePickerItem",(e=>{const t=this.props.currentBlockStore;return{key:e.name,render:t=>d().createElement(P.Z,r()({},t,{key:e.name,format:"phone-modal",title:e.name,type:e.type,icon:e.icon,locked:!1})),action:i=>{t&&(0,F.M_)(this.environment)&&(h.rNQ(this.environment,{name:e.name,is_keyboard:"keydown"===i.event.type}),e.onClick(this.environment,t))}}})),l()(this,"handleCloseColorPopup",(()=>{this.stores.store.setState({...this.stores.store.state,isColorOpen:!1})})),l()(this,"handleCloseInsertPopup",(()=>{this.stores.store.setState({...this.stores.store.state,isInsertOpen:!1})})),l()(this,"handleCloseTurnIntoPopup",(()=>{this.stores.store.setState({...this.stores.store.state,isTurnIntoOpen:!1})})),l()(this,"handleCloseTemplatesPopup",(()=>{this.stores.store.setState({...this.stores.store.state,isTemplatesOpen:!1})})),l()(this,"renderStore",this.createComputedStore((()=>{var e;return N.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)})))}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,i=this.isOpen(),{makeActionBarComponent:n}=this.props;return o()(c.Fragment,{},void 0,o()(f.Z,{capture:!0,render:e=>d().createElement("div",r()({},e,{style:{position:"relative",width:"100%",height:0,zIndex:k.Eo}}),n(this.stores),this.renderNativeMenuIgnoreSelectionArea(),this.renderInsertPopup(),this.renderTurnIntoPopup(),this.renderColorPopup(),this.renderTemplatesPopup())}),!i&&e.isIPhoneX&&e.isNative&&o()("div",{style:{position:"absolute",bottom:0,background:"transparent",height:t.state.paddingBottomCSS,width:"100%",pointerEvents:"none",WebkitUserSelect:"none"}}))}renderNativeMenuIgnoreSelectionArea(){const e=this.environment.NativeMobileActionBarStore;return e?o()(S.Z,{store:this.stores.ignoreSelectionAreaStore,capture:N.y6(this.environment),ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:"editing"!==C.default.state.mode&&e.state.shouldRestoreSelectionForMenu,render:e=>null}):null}renderInsertPopup(){const{device:e}=this.environment;return o()(S.Z,{capture:this.stores.store.state.isInsertOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:t=>o()(M.ZP,{popupType:e.isMobile?M.ZP.PopupType.SlideUp:M.ZP.PopupType.Popup,preventBlockRenderQueueOnEnter:!0,open:this.stores.store.state.isInsertOpen,keepFocus:!0,onDismiss:()=>{t(),this.handleCloseInsertPopup()},render:()=>o()(y.ZP,{menuType:y.ZP.MenuType.Modal,title:o()(x.FormattedMessage,{defaultMessage:"Insert block",id:"mobileActionBar.insertBlock.modalTitle"}),right:o()(D.CancelMenuText,{}),onClickRight:()=>{t(),this.handleCloseInsertPopup()}},void 0,o()(g.Z,{sections:u.kR,context:{environment:this.environment,blocks:T.default.state.stores},onAccept:this.handleCloseInsertPopup}))})})}renderTurnIntoPopup(){const{device:e}=this.environment;return o()(S.Z,{capture:this.stores.store.state.isTurnIntoOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>o()(M.ZP,{popupType:e.isMobile?M.ZP.PopupType.SlideUp:M.ZP.PopupType.Popup,open:this.stores.store.state.isTurnIntoOpen,keepFocus:!0,onDismiss:this.handleCloseTurnIntoPopup,preventBlockRenderQueueOnEnter:!0,render:()=>o()(y.ZP,{menuType:y.ZP.MenuType.Modal,title:o()(x.FormattedMessage,{defaultMessage:"Turn into",id:"mobileActionBar.turnInto.modalTitle"}),right:o()(D.CancelMenuText,{}),onClickRight:this.handleCloseTurnIntoPopup},void 0,o()(g.Z,{sections:[{...u.gH,title:""}],context:{environment:this.environment,blocks:T.default.state.stores},onAccept:this.handleCloseTurnIntoPopup}))})})}renderColorPopup(){const{device:e}=this.environment;return o()(S.Z,{capture:this.stores.store.state.isColorOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!0,render:()=>o()(M.ZP,{popupType:e.isMobile?M.ZP.PopupType.SlideUp:M.ZP.PopupType.Popup,open:this.stores.store.state.isColorOpen,keepFocus:!0,onDismiss:this.handleCloseColorPopup,preventBlockRenderQueueOnEnter:!0,render:()=>o()(y.ZP,{menuType:y.ZP.MenuType.Modal,title:o()(x.FormattedMessage,{defaultMessage:"Block color",id:"mobileActionBar.blockColor.modalTitle"}),right:o()(D.CancelMenuText,{}),onClickRight:this.handleCloseColorPopup},void 0,o()(g.Z,{sections:[u.te,u.rz,u.Vm],context:{environment:this.environment,blocks:T.default.state.stores},onAccept:this.handleCloseColorPopup}))})})}renderTemplatesPopup(){const{device:e}=this.environment;return o()(S.Z,{capture:this.stores.store.state.isTemplatesOpen,ignoreBlockSelection:!1,focusOffscreenInput:!1,restoreSelection:!1,render:()=>o()(M.ZP,{popupType:e.isMobile?M.ZP.PopupType.SlideUp:M.ZP.PopupType.Popup,open:this.stores.store.state.isTemplatesOpen,keepFocus:!0,render:()=>o()(y.ZP,{menuType:y.ZP.MenuType.Modal,title:o()(x.FormattedMessage,{defaultMessage:"Templates",id:"mobileActionBar.templates.modalTitle"}),right:o()(D.CancelMenuText,{}),onClickRight:this.handleCloseTemplatesPopup},void 0,o()(B.Z,{type:B.Z.Type.Vertical,store:this.stores.templatePickerMenuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onAccept:this.handleCloseTemplatesPopup,sections:[{key:"Basic",render:e=>o()(O.Z,{},void 0,e.children),items:I.ss.map(this.renderPageTemplatePickerItem)},{key:"Database",render:e=>o()(O.Z,{title:o()(x.FormattedMessage,{defaultMessage:"Database",id:"mobileActionBar.databaseSection.title"})},void 0,e.children),items:I.Im.filter((e=>e.shouldShow(this.environment))).map(this.renderPageTemplatePickerItem)},...Z.Ip(this.environment,this.props.intl).map((e=>({key:e.name,render:t=>o()(O.Z,{title:e.name},e.name,t.children),items:e.items.map(this.renderMobileTemplatePreviewItem)})))]}))})})}isOpen(){const{device:e}=this.environment;return e.isMobileBrowser?this.stores.store.state.isOpen:this.renderStore.state.shouldShow}}const L=(0,x.injectIntl)(U)},85394:(e,t,i)=>{i.r(t),i.d(t,{default:()=>k});var n=i(98135),o=i.n(n),s=i(59713),r=i.n(s),a=(i(33948),i(67294)),l=i(66832),c=i(14947),d=i(74647),h=i(3779),u=i(27832),m=i(51454),p=i(87531),b=i(70951),g=i(50906),y=i(55332),v=i(72653),S=i(43250);class f extends l.Z{constructor(...e){super(...e),r()(this,"handleClickFind",(()=>{p.Kf({environment:this.environment,analyticsFrom:"mobile-bottom-bar"}),g.nBz(this.environment,{itemName:"search"})})),r()(this,"handleClickQuickAdd",(()=>{d.quickAddPage({environment:this.environment,from:"mobile_bottom_bar"}),g.nBz(this.environment,{itemName:"add_page"})})),r()(this,"handleUndo",(()=>{y.Yw(this.environment,!0),g.nBz(this.environment,{itemName:"undo"})})),r()(this,"handleRedo",(()=>{y.KX(this.environment,!0),g.nBz(this.environment,{itemName:"redo"})})),r()(this,"canQuickAdd",this.createComputedStore((()=>Boolean(u.default.state.currentSpaceStore&&u.default.state.currentSpaceStore.canEdit()))))}renderComponent(){const e=v.Z.state;if(e){const{isTablet:t}=this.environment.device;return o()("div",{style:this.getWrapStyle(e),className:e?S.rK:S.al},void 0,t?this.renderTabletButtons():this.renderPhoneButtons())}}renderPhoneButtons(){return o()(a.Fragment,{},void 0,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton())}renderTabletButtons(){return o()(a.Fragment,{},void 0,this.renderSearchButton(),this.renderUpdatesButton(),this.renderQuickAddPageButton(),this.renderUndoRedoButtons())}renderSearchButton(){return o()(c.Z,{style:this.getSearchButtonStyle(),onClick:this.handleClickFind,mobileFeedback:!0},void 0,h.Z.mobileBottomBarSearch(this.getIconStyle()))}renderUpdatesButton(){const{isTablet:e}=this.environment.device;return o()(b.Z,{format:e?b.Z.Format.MobileBottomBarTablet:b.Z.Format.MobileBottomBarPhone})}renderQuickAddPageButton(){return o()(c.Z,{style:this.getQuickAddButtonStyle(),onClick:this.handleClickQuickAdd,mobileFeedback:!0,disabled:!this.canQuickAdd.state,disabledFeedback:!0},void 0,h.Z.mobileBottomBarAddPage(this.getIconStyle()))}renderUndoRedoButtons(){return o()(a.Fragment,{},void 0,o()(c.Z,{style:this.getUndoButtonStyle(),onClick:this.handleUndo,mobileFeedback:!0,disabled:!y.L0(),disabledFeedback:!0},void 0,h.Z.mobileBottomBarUndo(this.getIconStyle())),o()(c.Z,{style:this.getRedoButtonStyle(),onClick:this.handleRedo,mobileFeedback:!0,disabled:!y.AZ(),disabledFeedback:!0},void 0,h.Z.mobileBottomBarRedo(this.getIconStyle())))}getWrapStyle(e){const{WindowSizeStore:t}=this.environment,{isTablet:i}=this.environment.device;return{position:"absolute",left:0,right:0,bottom:0,display:"flex",justifyContent:i?"flex-start":"space-around",height:t.getSafePaddingBottomCSS(f.height),paddingBottom:t.state.paddingBottomCSS,background:this.theme.contentBackground,borderTop:"1px ".concat(this.theme.darkDividerColor," solid"),zIndex:m.D_,pointerEvents:e?"auto":"none",cursor:"pointer"}}getSearchButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return{display:"flex",alignItems:"center",justifyContent:"flex-start",flex:1,paddingLeft:e.getSafePaddingLeftCSS(18),...t&&{flex:"none",paddingLeft:2,width:f.tabletButtonWidth,justifyContent:"center"}}}getQuickAddButtonStyle(){const{WindowSizeStore:e}=this.environment,{isTablet:t}=this.environment.device;return{display:"flex",alignItems:"center",justifyContent:"flex-end",flex:1,paddingRight:e.getSafePaddingRightCSS(18),...t&&{justifyContent:"center",flex:"none",paddingRight:0,width:f.tabletButtonWidth,marginRight:"auto"}}}getUndoButtonStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"flex-start",flex:"none",paddingLeft:e.getSafePaddingLeftCSS(18),width:f.tabletButtonWidth}}getRedoButtonStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",flex:"none",width:f.tabletButtonWidth,paddingRight:4}}getIconStyle(){return{width:26,fill:this.theme.regularTextColor}}}r()(f,"height",44),r()(f,"tabletButtonWidth",54);const k=f},56140:(e,t,i)=>{i.r(t),i.d(t,{default:()=>K});var n=i(98135),o=i.n(n),s=i(59713),r=i.n(s),a=(i(33948),i(96486)),l=i.n(a),c=i(67294),d=i(17256),h=i(66832),u=i(3779),m=i(52016);class p extends m.Z{getInitialState(){return{}}}const b=p;var g=i(82990),y=i(84210),v=i(40039),S=i(79029),f=i(6695),k=i(42285),M=i(32918),T=i(65598),C=i(86512),w=i(48762),x=i(33929);class A extends h.Z{constructor(...e){super(...e),r()(this,"renderProperty",(e=>{const{schema:t,store:i,blockPropertyValueOverlayStore:n}=this.props;if(t[e])return o()(k.Z,{store:i,property:e,schema:t,disabled:!0,locked:!1,format:k.Z.Format.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n},e)}))}renderComponent(){const{time:e,store:t}=this.props,i=t.hasIcon()||!t.isEmptyPage(),n=(0,y.Z)({store:t,fullyQualified:!1}),s=T.Xp(t,{recursivelyLoadAllDiscussions:!1});return o()(C.Z,{href:n},void 0,o()(w.Z,{focused:!1,title:o()(c.Fragment,{},void 0,e&&o()("div",{style:{display:"flex",color:this.theme.mediumTextColor,fontSize:14,marginTop:8,marginBottom:6}},void 0,e),o()("div",{style:{display:"flex",alignItems:"center",...e&&{marginBottom:8}}},void 0,i&&o()(v.Z,{disabled:!0,icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),size:24,style:{flexShrink:0,marginRight:8}}),o()(S.Z,{store:t,style:{fontWeight:g.Z.fontWeight.semibold}}),s>0&&o()("div",{style:{display:"flex",alignItems:"center",color:this.theme.regularDividerColor,fontSize:12,marginLeft:4,flexShrink:0}},void 0,u.Z.speechBubble({width:12,height:12,marginRight:4,fill:this.theme.mediumIconColor}),s))),caption:this.renderProperties()}))}renderProperties(){const{format:e,schema:t,store:i}=this.props,n=(e.calendar_properties?e.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).filter((e=>f.XU({blockValue:i.getValue(),property:e,schema:t,getRecordValue:i.getRecordValue,userTimeZone:M.x7,intl:x.default.getIntl()})));if(n.length>0)return o()("div",{style:{marginTop:8}},void 0,n.map(this.renderProperty))}}const B=A;var I=i(26435),Z=i(26797),P=i(8646),R=i(95009),F=i(83071),O=i(13401),D=i(78948),N=i(16328),U=i(80527),L=i(26111),_=i(57269),q=i(68718),V=i(5366),W=i(15282),E=i(40863),z=i(75498),G=i(12318),j=i(85404);class Q extends h.Z{constructor(...e){super(...e),r()(this,"storeTypes",{store:b,resultStore:G.Z.of(void 0)}),r()(this,"renderResults",(()=>{const{disabled:e,collectionStore:t}=this.props,i=this.getCurrentStartOfDay(),n=i.clone().endOf("day"),s=this.getCurrentResults();return o()(R.ZP,{menuType:R.ZP.MenuType.Modal,title:o()("div",{style:Q.headerStyle},void 0,o()(U.Z,{onClick:this.handleLeftClick,icon:u.Z.chevronLeft,style:{marginRight:8,marginTop:2},mobileFeedback:!0}),o()("div",{},void 0,i.format("MMMM Do")),o()(U.Z,{onClick:this.handleRightClick,icon:u.Z.chevronRight,style:{marginLeft:8,marginTop:2},mobileFeedback:!0})),right:o()(W.DoneMenuText,{}),onClickRight:this.props.onDismiss},void 0,!s&&o()(F.Z,{},void 0,o()(D.Z,{})),s&&0===s.length&&o()(F.Z,{},void 0,o()(N.Z,{title:o()(V.FormattedMessage,{defaultMessage:"No items",id:"mobileCalendarDayMenu.noResults.message"})})),s&&s.length>0&&o()(F.Z,{},void 0,s.map((e=>{const o=I.Z.createChildStore(t,{id:e.id,table:j.iU});return this.renderItem(o,e,i,n)}))),!e&&o()(F.Z,{topBorder:!0},void 0,o()(O.Z,{focused:!1,onClick:this.handleAddItemClick,title:o()(V.FormattedMessage,{defaultMessage:"New item",id:"mobileCalendarDayMenu.newItemButton.label"})})))})),r()(this,"handleLeftClick",(()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState({...this.stores.store.state,currentStartOfDay:e.clone().add(-1,"day").valueOf()})})),r()(this,"handleRightClick",(()=>{const e=this.getCurrentStartOfDay();this.stores.store.setState({...this.stores.store.state,currentStartOfDay:e.clone().add(1,"day").valueOf()})})),r()(this,"handleAddItemClick",(()=>{const{collectionViewLocalStore:e,collectionStore:t,calendarBy:i,resultsStore:n}=this.props,o=this.getCurrentStartOfDay(),s=P.createAndCommit(this.environment,(s=>Z.uV({environment:this.environment,collectionStore:t,collectionViewLocalStore:e,calendarBy:i,startOfDay:o.valueOf(),results:n.state,transaction:s}))),r=(0,y.Z)({store:s});this.navigate(r)})),r()(this,"reducerStore",this.createComputedStore((()=>{const{collectionViewLocalStore:e}=this.props;return(0,E.YG)({collectionViewLocalStore:e,startOfDay:this.getCurrentStartOfDay().valueOf()})}),!0)),r()(this,"getRecordValue",this.props.collectionStore.getRecordValue)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):L.navigate({environment:this.environment,url:e})}renderComponent(){const{collectionViewLocalStore:e}=this.props,t=this.reducerStore.state;if(t)return o()(z.Z,{id:"calendar_day_results",reducer:t,collectionViewLocalStore:e,render:this.renderResults,resultStore:this.stores.resultStore})}renderItem(e,t,i,n){const{disabled:s,blockPropertyValueOverlayStore:r}=this.props;return o()(B,{store:e,time:t.includeTime?this.renderTime(t,i,n):void 0,disabled:s,format:this.props.format,schema:this.props.schema,blockPropertyValueOverlayStore:r},t.id)}renderTime(e,t,i){const{schema:n,calendarBy:o,intl:s}=this.props,r=n[o];if(!r||"date"!==r.type)return;const a=r.date_format||M.sF,l=r.time_format||M.c_,c=(0,d.Z)(e.start),h=e.end?(0,d.Z)(e.end):void 0,u=Boolean(!c.isBetween(t,i)||h&&!h.isBetween(t,i));if(e.end){const t=M.iC(e.start.valueOf(),e.end?e.end.valueOf():e.start.valueOf(),e.timeZone);return u?(0,_.ZV)({value:t,date_format:a,time_format:l,userTimeZone:e.timeZone,allowRelativeDates:!0,intl:s}):(0,_.ns)({start_time:t.start_time,end_time:t.end_time,time_format:l,humanReadable:!0,intl:s})}return(0,_.mr)({start_time:M.CQ(e.start.valueOf(),e.timeZone).start_time,time_format:l,humanReadable:!0,intl:s})}getCurrentStartOfDay(){const{currentStartOfDay:e}=this.stores.store.state;return e?(0,d.Z)(e):(0,d.Z)(this.props.initialStartOfDay)}getCurrentResults(){const{collectionStore:e,collectionViewLocalStore:t}=this.props,i=this.stores.resultStore.state,n=t.normalizedQueryStore.state,o=t.normalizedSchemaStore.state,s=n?n.calendar_by:void 0;if(!(i&&n&&s&&o))return;let r=l().compact(i.blockIds.map((t=>{const i=I.Z.createChildStore(e,{id:t,table:j.iU});return(0,E.BO)({blockStore:i,calendarBy:s,schema:o,getRecordValue:this.getRecordValue,intl:this.props.intl})})));return n.sort||(r=l().sortBy(r,(e=>e.start))),r}}r()(Q,"contextTypes",q.u),r()(Q,"headerStyle",{display:"flex",alignItems:"center",height:"100%"});const K=(0,V.injectIntl)(Q)},25079:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ae});var n=i(98135),o=i.n(n),s=i(59713),r=i.n(s),a=(i(33948),i(67294)),l=i.n(a),c=i(66832),d=i(48542),h=i(87531),u=i(592),m=i(86777),p=i(81307),b=i(21323),g=i(47590),y=i(61045),v=i(67154),S=i.n(v),f=i(46167),k=i(376),M=i(14694),T=i(3779),C=i(95009),w=i(14786),x=i(14947),A=i(32310),B=i(79092),I=i(88632),Z=i(27386),P=i(29368),R=i(46951),F=i(1548),O=i(72087),D=i(68932),N=i(27832),U=i(37181),L=i(5366),_=i(78291),q=i(1643),V=i(97148),W=i(30045),E=i(23189),z=i(42982),G=i(79603);class j extends c.Z{constructor(...e){super(...e),r()(this,"storeTypes",{passwordRequestStore:O.Z}),r()(this,"handleClose",(()=>{w.Z.setState({open:!1})})),r()(this,"handleStartOfWeekToggle",(()=>{1===this.getStartDayOfWeek()?(0,U.rx)(this.environment):(0,U.Zf)(this.environment)}))}renderComponent(){const{device:e}=this.environment,{data:t}=_.default.state,i=w.Z.state.open,n="on"===V.default.getGroup(this.environment,"user-data-consent"),s=e.isIOS&&q.wY(t);return o()(f.Z,{popupType:e.isMobile?f.Z.PopupType.SlideUp:f.Z.PopupType.Popup,buttonPopupStore:w.Z,renderOrigin:e=>l().createElement(x.Z,S()({mobileFeedback:this.props.isMobile},e),o()(M.Z,{left:this.renderIcon(),style:{background:i?this.theme.buttonHoveredBackground:"none"},isMobile:this.props.isMobile,disableMobileBorder:!0},void 0,o()(L.FormattedMessage,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.label"}))),render:()=>{let i;if(i=e.isMobile?{menuType:C.ZP.MenuType.Modal,title:o()(L.FormattedMessage,{defaultMessage:"Notifications & settings",id:"notificationSettingsButton.mobileSidebar.title"}),right:o()(L.FormattedMessage,{defaultMessage:"Done",id:"notificationSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose,whiteBackground:!0}:{menuType:C.ZP.MenuType.Popup},I.Z.state.online){const{passwordRequestStore:e}=this.stores;return l().createElement(C.ZP,i,e.state.loading?o()(D.Z,{style:{margin:"50% auto"}}):o()(Z.Z,{disableScroller:!0},void 0,o()(k.Z,{}),o()(P.Z,{size:48,isHidden:!0}),o()(E.Z,{divider:"full"},void 0,o()(L.FormattedMessage,{id:"notificationSettingsButton.generalSection.title",defaultMessage:"General"})),o()(F.Z,{requestStore:e,isEducationPlan:q.wl(t)}),this.renderAppearanceSettings(),s&&this.renderSubscriptionSettings(),n&&this.renderUserDataConsentSettings(),o()(P.Z,{size:32}),o()(B.Z,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:this.getStartDayOfWeek()||0}),(0,G.mS)(this.environment)&&this.renderExperimentsSettings()))}return o()(Z.Z,{},void 0,o()(R.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(L.FormattedMessage,{defaultMessage:"Please go online to manage settings.",id:"notificationSettingsButton.goOnline.prompt"})))}})}renderUserDataConsentSettings(){return o()(l().Fragment,{},void 0,o()(P.Z,{size:32}),o()(W.Z,{}))}renderAppearanceSettings(){return o()(l().Fragment,{},void 0,o()(P.Z,{size:32}),o()(A.Z,{}))}renderExperimentsSettings(){return o()(l().Fragment,{},void 0,o()(P.Z,{size:32}),o()(G.Pp,{}))}renderSubscriptionSettings(){return o()(l().Fragment,{},void 0,o()(P.Z,{size:32}),o()(z.Z,{}))}renderIcon(){return T.Z.sidebarSettings({fill:this.theme.mediumIconColor,width:16})}getStartDayOfWeek(){const{currentUserSettingsStore:e}=N.default.state;if(e){const t=e.getSettings();if(t)return t.start_day_of_week}}}const Q=j;var K=i(90287),Y=i(50906);class H extends c.Z{renderComponent(){const e=o()(L.FormattedMessage,{defaultMessage:"Upgrade to Pro",id:"upgradeMobileButton.upgradeButton.label"});return o()(x.Z,{mobileFeedback:!0,onClick:this.showUpgradeModal(this.environment)},void 0,o()(M.Z,{left:this.renderIcon(),isMobile:!0,disableMobileBorder:!0},void 0,e))}renderIcon(){return T.Z.settingsUpgradeFilled({fill:this.theme.mediumIconColor,width:16})}showUpgradeModal(e){return()=>{(0,Y.sA6)(e,{from:"mobile_sidebar",for_subscription_tier:"personal"});const{mobileNative:t}=e;t&&t.openUpgradeModal((0,K.Bs)())}}}const J=H;var X=i(61766),$=i(58280);class ee extends c.Z{constructor(...e){super(...e),r()(this,"storeTypes",{buttonPopupStore:X.Z}),r()(this,"handleClose",(()=>{this.stores.buttonPopupStore.setState({open:!1})}))}renderComponent(){if(!q.lw(this.environment))return;const{store:e}=this.props,{buttonPopupStore:t}=this.stores;return o()(f.Z,{buttonPopupStore:t,popupType:f.Z.PopupType.SlideUp,renderOrigin:e=>l().createElement(x.Z,S()({mobileFeedback:!0},e),o()(M.Z,{left:this.renderIcon(),isMobile:!0,disableMobileBorder:!0},void 0,o()(L.FormattedMessage,{defaultMessage:"Members",id:"memberSettingsButton.mobileSidebar.label"}))),render:()=>{if(I.Z.state.online){const t={menuType:C.ZP.MenuType.Modal,title:o()(L.FormattedMessage,{defaultMessage:"Members",id:"memberSettingsButton.mobileMemberSettings.title"}),right:o()(L.FormattedMessage,{defaultMessage:"Done",id:"memberSettingsButton.rightActionButton.done"}),onClickRight:this.handleClose};return l().createElement(C.ZP,t,o()($.Z,{store:e,isMobile:!0}))}this.renderOffline()}})}renderIcon(){return T.Z.teamSize({fill:this.theme.mediumIconColor,width:16})}renderOffline(){return o()(Z.Z,{},void 0,o()(R.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(L.FormattedMessage,{defaultMessage:"Please go online to manage members.",id:"memberSettingsButton.goOnline.prompt"})))}}const te=ee;var ie=i(74647),ne=i(89206),oe=i(29477),se=i(24677),re=i(7755),ae=i(80796),le=i(29337),ce=i(43250),de=i(45094);const he=200;class ue extends c.Z{constructor(...e){super(...e),r()(this,"handleTouchStart",(e=>{const t={x:e.touches[0].clientX,y:e.touches[0].clientY};re.TC.state?t.x>(0,de.qG)(this.environment)?le.Z.setState({touching:!0,swiping:!1,start:t}):this.handleReset():(0,de.YR)(this.environment)&&t.x<100?le.Z.setState({touching:!0,swiping:!1,start:t}):this.handleReset()})),r()(this,"handleTouchMove",(e=>{if(ae.Z.state.isDragging)return void this.handleReset();const t=le.Z.state;if(!t.touching)return;const i={x:e.touches[0].clientX,y:e.touches[0].clientY};if(t.swiping)le.Z.setState({touching:!0,swiping:!0,start:t.start,speed:re.TC.state?t.end.x-i.x:i.x-t.end.x,end:i});else{if(Math.abs(i.y-t.start.y)>=25)return void this.handleReset();(!re.TC.state&&i.x-t.start.x>25||re.TC.state&&t.start.x-i.x>25)&&le.Z.setState({touching:!0,swiping:!0,start:t.start,speed:0,end:i})}this.updateTransform()})),r()(this,"handleTouchEnd",(async()=>{const{ThemeStore:e}=this.environment,t=le.Z.state;if(!t.swiping)return;const i=(0,de.qG)(this.environment),n=document.querySelector((0,de.YR)(this.environment)?".".concat(ce.yk):".".concat(ce.Wi)),o=document.querySelector(".".concat(ce.Wi)),s=Math.abs(t.speed)>=8,r=s?"ease-out":"ease-in-out",a="dark"===e.state.mode?", 1px 0 0 ".concat(this.theme.shadowColor.alpha(2*this.theme.shadowOpacity).css()):"",l="\n\t\t\t".concat(this.theme.mediumBoxShadow,"\n\t\t\t").concat(a,"\n\t\t");if(re.TC.state){const e=t.start.x-t.end.x;if(e+25*t.speed>i/2){let t=s?(i-e)/i*he:he;t=Math.max(t,1),n.style.transition="transform ".concat(t,"ms ").concat(r),n.style.transform="translateZ(0)translateX(0px)",(0,de.YR)(this.environment)&&(n.style.boxShadow=l,o.style.transition="filter ".concat(t,"ms ").concat(r),o.style.filter="brightness(1)"),await pe(n),ie.close(),this.handleReset()}else n.style.transition="transform ".concat(he,"ms ").concat(r),n.style.transform="translateZ(0)translateX(".concat(i,"px)"),(0,de.YR)(this.environment)&&(n.style.boxShadow=l,o.style.transition="filter ".concat(he,"ms ").concat(r),o.style.filter="brightness(0.7)"),await pe(n),this.handleReset()}else{const e=t.end.x-t.start.x;if(e+25*t.speed>i/2){let t=s?(i-e)/i*he:he;t=Math.max(t,1),n.style.transition="transform ".concat(t,"ms ").concat(r),n.style.transform="translateZ(0)translateX(".concat(i,"px)"),(0,de.YR)(this.environment)&&(n.style.boxShadow=l,o.style.transition="filter ".concat(t,"ms ").concat(r),o.style.filter="brightness(0.7)"),await pe(n),ie.open(),this.handleReset()}else n.style.transition="transform ".concat(he,"ms ").concat(r),n.style.transform="translateZ(0)translateX(0px)",(0,de.YR)(this.environment)&&(n.style.boxShadow=l,o.style.transition="filter ".concat(he,"ms ").concat(r),o.style.filter="brightness(1)"),await pe(n),this.handleReset()}})),r()(this,"handleSidebarToggle",(()=>{this.updateTransform()})),r()(this,"updateTransform",(()=>{const e=document.querySelector((0,de.YR)(this.environment)?".".concat(ce.yk):".".concat(ce.Wi)),t=document.querySelector(".".concat(ce.Wi)),i=(0,de.qG)(this.environment),n=le.Z.state;if(n.swiping)if(re.TC.state){const o=i-(n.start.x-n.end.x)+25,s=Math.min(Math.max(0,o),i);if(e.style.transition="none",e.style.transform="translateZ(0)translateX(".concat(s,"px)"),(0,de.YR)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="none";const n=(1-.3*s/i).toString();t.style.filter="brightness(".concat(n,")")}}else{const o=n.end.x-n.start.x-25,s=Math.min(Math.max(0,o),i);if(e.style.transition="none",e.style.transform="translateZ(0)translateX(".concat(s,"px)"),(0,de.YR)(this.environment)){e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="none";const n=(1-.3*s/i).toString();t.style.filter="brightness(".concat(n,")")}}else re.TC.state?(e.style.transition="transform 200ms",e.style.transform="translateZ(0)translateX(".concat(i,"px)"),(0,de.YR)(this.environment)&&(e.style.transform="translateZ(0)translateX(calc(".concat(i,"px - 1px))"),e.style.boxShadow=this.theme.mediumBoxShadow,t.style.transition="filter 200ms",t.style.filter="brightness(0.7)"),se.ZH(this.environment)):(e.style.transition="transform 200ms",e.style.transform="translateZ(0)translateX(0)",(0,de.YR)(this.environment)&&(e.style.boxShadow="none",t.style.transition="filter 200ms",t.style.filter="brightness(1)"))}))}didMount(){const{device:e}=this.environment;e.isMobile&&(window.addEventListener("touchstart",this.handleTouchStart),window.addEventListener("touchmove",this.handleTouchMove),window.addEventListener("touchend",this.handleTouchEnd),re.TC.addListener(this.handleSidebarToggle))}willUnmount(){const{device:e}=this.environment;e.isMobile&&(window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd),re.TC.removeListener(this.handleSidebarToggle))}handleReset(){le.Z.reset(),this.updateTransform()}}const me=ue;async function pe(e){const t=oe.UZ();e.addEventListener("transitionend",t.resolve),e.addEventListener("webkitTransitionEnd",t.resolve),await t.promise,e.removeEventListener("transitionend",t.resolve),e.removeEventListener("webkitTransitionEnd",t.resolve)}var be=i(45589),ge=i(45010),ye=i(8848),ve=i(28020),Se=i(13548),fe=i(41507),ke=i(31280),Me=i(40783),Te=i(52533),Ce=i(95477),we=i(29974);class xe extends c.Z{constructor(...e){super(...e),r()(this,"sidebarState",this.createComputedStore((()=>(0,ve.vK)(this.environment)))),r()(this,"storeTypes",{scrollerStore:be.Z}),r()(this,"handleScrollerMount",(e=>{ge.Z.SidebarMobileScroller=e})),r()(this,"handleCloseSidebar",(()=>{ie.close()})),r()(this,"handleClickFind",(()=>h.Kf({environment:this.environment,analyticsFrom:"sidebar-mobile"}))),r()(this,"handleOrientationChange",(()=>{ie.close()})),r()(this,"isScrolledToTop",this.createComputedStore((()=>0===this.stores.scrollerStore.state.scrollTop))),r()(this,"isCurrentIAPSubscriber",(()=>{const{currentUserRootStore:e}=N.default.state,t=(0,q.xR)({environment:this.environment,userRootStore:e});return!(!t||!t.includes(Ce.default.revenueCat.productIDs.personal.monthly)&&!t.includes(Ce.default.revenueCat.productIDs.personal.yearly))}))}willMount(){window.addEventListener("resize",this.handleOrientationChange)}willUnmount(){window.removeEventListener("resize",this.handleOrientationChange)}renderComponent(){const e=de.Jr(this.environment);return e?o()(Se.Z,{render:()=>o()("div",{className:ce.yk,style:this.getWrapStyle()},void 0,!e&&o()(me,{}),this.renderSidebar()),isVisible:!0,animationStyle:{width:e?de.Wk(this.environment):"100vw"}}):o()("div",{className:ce.yk,style:{...this.getWrapStyle(),width:"100vw"}},void 0,!e&&o()(me,{}),this.renderSidebar())}renderSidebar(){return o()(ne.Z,{capture:!de.Jr(this.environment)&&re.TC.get(),onBackButton:this.handleCloseSidebar},void 0,o()("div",{style:this.getStyle()},void 0,this.renderTopbar(),this.renderOutliner()))}renderTopbar(){const{device:e}=this.environment,t=e.isMobileNative&&e.isTablet&&de.Jr(this.environment);return o()("div",{style:this.getTopbarStyle()},void 0,o()(ke.ZP,{shouldShowUnexpandButton:t,format:ke._S.Mobile,onSpaceClick:async({event:e,spaceViewStore:t})=>{await we.y3({environment:this.environment,spaceViewStore:t,userSettingsStore:N.default.state.currentUserSettingsStore,userRootStore:N.default.state.currentUserRootStore,metaClick:e.ctrlKey||e.metaKey})}}),!e.isMobileNative&&o()(x.Z,{onClick:this.handleClickFind,mobileFeedback:!0,style:xe.actionButtonStyle},void 0,T.Z.mobileBottomBarSearch({width:26})))}renderOutliner(){const{currentSpaceStore:e,currentSpaceViewStore:t,currentUserRootStore:i,currentUserStore:n,currentUserSettingsStore:s,currentBlockStore:r}=N.default.state,a=this.sidebarState.state;if(!(a&&r&&t&&i&&e&&n&&s))return;const c=e.canEdit(),h=(0,Te.S)({environment:this.environment})&&"personal_free"===(0,q.CM)(this.environment)&&_.default.state.data&&"unsubscribed_admin"===_.default.state.data.type&&_.default.state.data.revenueCatEnabled&&!this.isCurrentIAPSubscriber();return o()(g.Z,{store:e,disableEditNearestBlock:!0,render:i=>l().createElement(u.ZP,{store:this.stores.scrollerStore,ref:this.handleScrollerMount,style:xe.outlinerStyle,disableScroll:y.H6(this.environment),type:u.xm.Y},a.showBookmarksSection&&o()(p.Z,{isMobile:!0,type:"bookmarks",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>o()(d.Z,{isMobile:!0,type:"bookmarks",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:t.getBookmarkedPagesStore(),childStores:t.getBookmarkedPages(),showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!c})}),a.showWorkspaceSection&&o()(p.Z,{isMobile:!0,type:"workspace",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>o()(d.Z,{isMobile:!0,type:"workspace",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getWorkspacePages(),addPageTitle:o()(L.FormattedMessage,{defaultMessage:"Add a page",id:"sidebarMobile.addPageToWorkspace.title"}),onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,showAddPageButton:!0,disabled:!c})}),a.showSharedSection&&o()(p.Z,{isMobile:!0,type:"shared",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:i=>l().createElement(l().Fragment,null,o()(d.Z,{isMobile:!0,type:"shared",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:t.getSharedPagesStore(),childStores:a.visibleSharedPagesStores,showAddPageButton:!1,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!c}),a.showSharedOverflowButton&&o()(Me.Z,{originRef:i,isMobile:!0,type:"shared",spaceStore:e,spaceViewStore:t,userSettingsStore:s,allSharedPages:a.allSharedPagesStores,visiblePageIds:a.visibleSharedPagesStores.map((({id:e})=>e))}))}),a.showPrivateSection&&!a.showOnlyPrivateSection&&o()(p.Z,{isMobile:!0,type:"private",spaceStore:e,spaceViewStore:t,showAddPageButton:!1,renderSidebar:()=>o()(d.Z,{isMobile:!0,type:"private",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(this.environment),addPageTitle:o()(L.FormattedMessage,{defaultMessage:"Add a page",id:"sidebarMobile.addAPrivatePage.title"}),showAddPageButton:!0,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!c})}),a.showOnlyPrivateSection&&o()(d.Z,{isMobile:!0,type:"private",isTopLevel:!0,spaceStore:e,spaceViewStore:t,parentStore:e.getPagesStore(),childStores:t.getPrivatePages(this.environment),addPageTitle:o()(L.FormattedMessage,{defaultMessage:"Add a page",id:"sidebarMobile.addAPageToOnlyPrivateSection.title"}),showAddPageButton:!0,onNavigate:this.handleCloseSidebar,onCreatePage:this.handleCloseSidebar,disabled:!c}),a.showOnlyPrivateSection&&o()("div",{style:{height:20}}),o()(te,{store:e}),o()(Q,{isMobile:!0}),e.canEdit()&&o()(b.Z,{store:r,isMobile:!0}),h&&o()(J,{}),o()(m.Z,{isMobile:!0}),o()("div",{style:{height:128}}))})}getWrapStyle(){return de.Jr(this.environment)?{display:"block",height:"100vh",position:"relative",zIndex:3}:de.YR(this.environment)?{display:"block",height:"100vh",position:"fixed",top:0,right:"100%",zIndex:3}:{display:"block",height:"100vh",position:"fixed",top:0,left:0}}getStyle(){return{display:"flex",flexDirection:"column",width:de.qG(this.environment),height:"100%",background:de.YR(this.environment)?this.theme.mobileSidebarAndroidBackground:this.theme.mobileSidebarIOSBackground,willChange:"transform",color:this.theme.mediumTextColor,...de.YR(this.environment)&&{marginLeft:"auto"},...de.Jr(this.environment)&&{position:"absolute",right:0},cursor:"pointer"}}getTopbarStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"space-between",flex:"none",height:fe.g,marginTop:e.state.paddingTopCSS,paddingLeft:12,boxShadow:de.YR(this.environment)&&!de.Jr(this.environment)&&re.TC.state?this.isScrolledToTop.state?this.theme.topbarAndroidShadowCollapsed:this.theme.topbarAndroidShadow:"0 1px 0 ".concat(this.theme.darkDividerColor),background:de.YR(this.environment)?this.theme.androidSidebarBackground:ye.ZP.transparent,transition:"box-shadow 300ms",width:"100%",zIndex:1}}}r()(xe,"outlinerStyle",{flexGrow:1,paddingTop:12,userSelect:"none",WebkitUserSelect:"none"}),r()(xe,"actionButtonStyle",{display:"flex",alignItems:"center",justifyContent:"center",flex:"none",height:"100%",width:44,paddingRight:6});const Ae=xe},47589:(e,t,i)=>{i.r(t),i.d(t,{default:()=>be});var n=i(67154),o=i.n(n),s=i(98135),r=i.n(s),a=i(59713),l=i.n(a),c=(i(33948),i(67294)),d=i.n(c),h=i(51454),u=i(50906),m=i(3779),p=i(26435),b=i(64442),g=i(61766),y=i(1449),v=i(46167),S=i(66832),f=i(48601),k=i(43803),M=i(87953),T=i(53786),C=i(39849),w=i(21325),x=i(74647),A=i(24677),B=i(22789),I=i(52258),Z=i(76487),P=i(14947),R=i(43250),F=i(67669),O=i(42001),D=i(13612),N=i(87531),U=i(27832),L=i(29974),_=i(82990),q=i(11302),V=i(40039),W=i(79029),E=i(15517),z=i(70951),G=i(8848),j=i(26111),Q=i(39865),K=i(8646),Y=i(20088),H=i(85404),J=i(42330),X=i(64581),$=i(28020),ee=i(7755),te=i(45094),ie=i(11819),ne=i(5366),oe=i(62442),se=i(41507),re=i(38755),ae=i(84122),le=i(77907),ce=i(24666),de=i(98104),he=i(69454),ue=i(3750),me=i(30366);class pe extends S.Z{constructor(...e){super(...e),l()(this,"storeTypes",{shareButtonPopupStore:g.Z}),l()(this,"handleOpenQuickFind",(()=>{N.UT({environment:this.environment,analyticsFrom:"public-page-topbar"})})),l()(this,"handleShareClick",(()=>{u.DB2(this.environment),w.bi(this.environment)})),l()(this,"handleTopbarClick",(()=>{A.ZH(this.environment)})),l()(this,"navigateToFirstSpace",(()=>{const{currentUserRootStore:e,currentUserSettingsStore:t}=U.default.state;e&&t&&L.L5({environment:this.environment,userRootStore:e,userSettingsStore:t})})),l()(this,"handleMoveToClick",(e=>{q.bA({blocks:[this.props.store],analyticsFrom:"quick_add",onAccept:this.handleMoveToAccept,isAddTo:!0})})),l()(this,"handleMoveToAccept",(e=>{const{currentSpaceStore:t}=U.default.state;t&&this.props.saveParent&&E.rq({currentUserId:this.environment.currentUser.id,spaceId:t.id,value:e}),u.xx2(this.environment)})),l()(this,"handleCancelQuickAdd",(e=>{const t=U.default.state.currentBlockStore,i=J.Z.state.lastPageId;t&&i&&(j.navigateToBlock({environment:this.environment,store:p.Z.createChildStore(t,{table:H.iU,id:i}),showMoveTo:!1,saveParent:!1}),K.createAndCommit(this.environment,(e=>{Q.y8({environment:this.environment,blocks:[t],transaction:e})})))}))}renderComponent(){const{store:e}=this.props,{WindowSizeStore:t,device:i}=this.environment,n=(0,F.IJ)(this.environment,this.props.store);return r()(M.Z,{capture:!0,render:s=>d().createElement("div",o()({},s,{style:this.getWrapStyle()}),n?this.renderPublicPageTopbar():this.renderNormalTopbar(),e.canEdit()&&i.isPhone&&r()(B.Z,{store:this.props.store,isMobile:!0},this.props.store.id),this.props.isOffline&&r()(Y.Z,{type:Y.$.White,isMobile:!0},void 0,r()("div",{style:{display:"flex",alignItems:"center",width:"100%",paddingLeft:t.getSafePaddingLeftCSS(10),paddingRight:t.getSafePaddingRightCSS(14)}},void 0,m.Z.mobileOffline({width:26,marginRight:12}),r()("div",{},void 0,r()(ne.FormattedMessage,{defaultMessage:"You're offline",id:"topbarMobile.offline.message"})))),r()(f.Z,{banners:this.props.banners,isMobile:!0}))})}renderPublicPageTopbar(){const{store:e}=this.props;return r()("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:R.ZH},void 0,this.environment.currentUser.isLoggedIn()&&r()(c.Fragment,{},void 0,r()(P.Z,{style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:14,paddingRight:14,fontWeight:_.Z.fontWeight.medium,color:this.theme.regularTextColor},mobileFeedback:!0,onClick:this.navigateToFirstSpace},void 0,r()(ne.FormattedMessage,{defaultMessage:"Back",id:"topbarMobile.backButton.label"})),r()("div",{style:{height:18,width:1,flexShrink:0,marginRight:6,background:this.theme.darkDividerColor}})),r()(y.Z,{store:this.props.store,style:this.getBreadcrumbsStyle(),maxAncestorCount:1,showCurrentPageControls:!1,ancestorMaxWidth:100,currentPageMaxWidth:220,isMobile:!0}),r()("div",{style:{flexGrow:1,flexShrink:1}}),r()(O.Z,{onClick:this.handleOpenQuickFind},void 0,m.Z.searchThick({width:20,height:20})),r()(D.Z,{store:e,buttonPopupStore:I.Z}))}renderNormalTopbar(){const{store:e,pageVisitStore:t,presenceStore:i}=this.props,{isTablet:n}=this.environment.device,o=this.props.isInvalidPage;return r()("div",{onClick:this.handleTopbarClick,style:this.getStyle(),className:R.ZH},void 0,this.renderHamburgerButton(),n&&r()(oe.Z,{}),!o&&this.renderBreadcrumbs(),e.canEdit()&&n&&r()(B.Z,{store:e,isMobile:!1},e.id),r()(T.Z,{}),e.isRestricted()&&r()(ae.Z,{style:{marginRight:8},onClick:()=>{this.stores.shareButtonPopupStore.setState({open:!0})}}),n&&e.canEdit()&&t&&i&&r()(ie.Z,{rootStore:e,pageVisitStore:t,presenceStore:i}),this.props.shouldShowMoveTo?this.renderCancelQuickAdd():this.renderRightButtons())}renderHamburgerButton(){const e=Z.Z.getUnreadMentionsCountForOtherSpaces();return r()(P.Z,{mobileFeedback:!0,style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,height:"100%",width:36,marginLeft:4},onClick:()=>{if((0,te.Jr)(this.environment))x.setExpand({environment:this.environment,isExpanded:!ee.gV.get()});else{const{NativeMobileActionBarStore:e}=this.environment,t=e?e.state.menuType:null;"editing"===ce.default.state.mode||null!==t?(de.ZH(this.environment),null==e||e.clear(!1),he.Z.onHide((()=>{ue.default.afterNextFlush((()=>x.open()))}))):x.open()}u.jDo(this.environment)}},void 0,m.Z.hamburgerMenu({width:18,height:18}),r()(C.Z,{color:C.Z.Color.Red,count:e,style:{position:"absolute",top:9,right:1}}))}renderBreadcrumbs(){const{isTablet:e}=this.environment.device;return this.props.shouldShowMoveTo?this.renderMoveTo():r()(y.Z,{store:this.props.store,style:this.getBreadcrumbsStyle(),maxAncestorCount:e?2:1,showCurrentPageControls:!1,ancestorMaxWidth:e?160:100,currentPageMaxWidth:e?240:220,isMobile:!0})}renderMoveTo(){const{store:e}=this.props,t=e.getParentStore(),{currentSpaceStore:i}=U.default.state,n=t instanceof b.Z&&i&&t.id===i.id;if(!(t instanceof me.Z)&&t){if(n)return r()(P.Z,{mobileFeedback:!0,style:pe.moveToButtonStyle,onClick:this.handleMoveToClick},void 0,r()(ne.FormattedMessage,{defaultMessage:"<mediumcolor>Add to</mediumcolor>{userAvatar}<mediumweight>Private pages</mediumweight>",id:"topbarMobile.addToPrivateSectionButton.label",values:{mediumcolor:(...e)=>r()("span",{style:{color:this.theme.mediumTextColor,marginRight:8}},void 0,e),mediumweight:(...e)=>r()("span",{style:{fontWeight:_.Z.fontWeight.medium,marginLeft:4}},void 0,e),userAvatar:r()(X.Z,{size:22,avatarShouldShowShadow:!0,userValue:(0,$.S4)(this.environment)})}}),this.renderChevron());{const i=e instanceof b.Z?(0,re.getSpaceIcon)(this.environment,e):e.getIcon();return r()(P.Z,{mobileFeedback:!0,style:pe.moveToButtonStyle,onClick:this.handleMoveToClick},void 0,r()("span",{style:{color:this.theme.mediumTextColor}},void 0,r()(ne.FormattedMessage,{defaultMessage:"Add to",id:"topbarMobile.addToPageOrWorkspaceSectionButton.label",description:"Displayed to the user in front of a page or space, like 'Add to Page', where 'Page' is an existing page."})," "),r()(V.Z,{disabled:!0,icon:i,isEmptyPage:t.table===H.iU&&t.isEmptyPage(),title:t instanceof b.Z?(0,re.getSpaceName)(this.environment,t):void 0,size:24,style:{marginLeft:8,marginRight:4}}),r()(W.Z,{style:{fontWeight:_.Z.fontWeight.semibold},store:t}),this.renderChevron())}}}renderChevron(){return m.Z.chevronDown({marginLeft:4,width:10,fill:this.theme.lightTextColor})}renderRightButtons(){const{device:e}=this.environment;if(!this.props.isInvalidPage)return e.isMobileNative?r()(c.Fragment,{},void 0,this.renderShare(),this.renderShowMore()):r()(c.Fragment,{},void 0,this.renderShowMore(),this.renderShare(),this.renderUpdatesButton())}renderCancelQuickAdd(){return r()(P.Z,{mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:16,paddingRight:16,fontWeight:_.Z.fontWeight.medium,color:G.ZP.blue},onClick:this.handleCancelQuickAdd},void 0,r()(ne.FormattedMessage,{defaultMessage:"Cancel",id:"topbarMobile.cancelQuickAddButton.label"}))}renderShowMore(){return r()(k.Z,{store:this.props.store,collectionViewStore:this.props.collectionViewStore,buttonPopupStore:I.Z})}renderShare(){const{device:e}=this.environment;return r()(v.Z,{popupType:e.isMobile?v.Z.PopupType.SlideUp:v.Z.PopupType.Popup,style:{width:460},buttonPopupStore:this.stores.shareButtonPopupStore,onClick:this.handleShareClick,renderOrigin:t=>d().createElement(P.Z,o()({mobileFeedback:!0,style:pe.actionButtonStyle},t),e.isAndroid?m.Z.androidShare({width:16,height:16}):m.Z.iOSShare({width:26})),render:()=>r()(le.LazyBlockPermissionsSettings,{buttonPopupStore:this.stores.shareButtonPopupStore,store:this.props.store,onClose:()=>{this.stores.shareButtonPopupStore.setState({...this.stores.shareButtonPopupStore.state,open:!1})}})})}renderUpdatesButton(){return r()(z.Z,{format:z.Z.Format.TopbarMobile})}getWrapStyle(){return{width:"100%",maxWidth:"100vw",zIndex:h.lI}}getStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",maxWidth:"100vw",height:se.g,marginTop:e.state.paddingTopCSS,paddingLeft:e.getSafePaddingLeftCSS(0),paddingRight:this.props.shouldShowMoveTo?e.getSafePaddingRightCSS(0):e.getSafePaddingRightCSS(7),boxShadow:"0 1px 0 ".concat(this.theme.darkDividerColor),background:this.theme.contentBackground,transition:"box-shadow 300ms",WebkitUserSelect:"none",cursor:"pointer"}}getBreadcrumbsStyle(){const{isTablet:e}=this.environment.device;return{flexGrow:0,marginLeft:2,overflow:"auto",WebkitOverflowScrolling:"touch",marginRight:e?16:8,height:"100%"}}}l()(pe,"actionButtonStyle",{display:"flex",alignItems:"center",height:"100%",paddingLeft:6,paddingRight:6}),l()(pe,"moveToButtonStyle",{display:"flex",alignItems:"center",paddingLeft:8,paddingRight:12,fontSize:_.Z.fontSize.UIRegular.mobile,lineHeight:_.Z.lineHeight.UIRegular.mobile,whiteSpace:"nowrap",minWidth:0});const be=pe},2768:(e,t,i)=>{i.r(t),i.d(t,{default:()=>re});var n=i(98135),o=i.n(n),s=i(59713),r=i.n(s),a=(i(33948),i(58879)),l=i(96486),c=i.n(l),d=i(67294),h=i.n(d);function u(e,t){const i=(0,d.useRef)(Math.random().toString(36).substr(2,9)),n=t,o=(0,d.useRef)();return(0,d.useEffect)((()=>{if(o&&o.current&&c().isEqual(o.current,n))return;const t=i.current;e&&(e({type:"mount",id:t,props:n}),o.current=n)}),[e,n]),e?i.current:void 0}var m=i(66832),p=i(5366),b=(i(85827),i(74487)),g=i(36054);function y(e,t,i){const{content:n,apiRequestValue:o}=i;return{id:e,content:n,action:{type:t,apiRequestValue:o}}}const v=["insertBlock","turnInto","textColor","textSelectionColor"],S=["textFormatting"];function f(e,t){return{type:e,apiRequestValue:t}}function k(e,t){const i={type:e,data:t};return JSON.stringify(i)}const M={showActionBarMenu:b.Ry({required:{type:b.i0("showActionBarMenu"),data:b.Ry({required:{actionBarMenuId:b.eR("textColor","insertBlock","turnInto","template")},optional:{}})},optional:{}}),blockAction:b.Ry({required:{type:b.eR("blockAction"),data:b.Ry({required:{action:b.eR("bold","italic","underline","strikethrough","link","code","equation","mention","trash","comment","filePicker","indent","unindent","moveUp","moveDown","undo","redo","dismissKeyboard","more")},optional:{}})},optional:{}})},T=Object.keys(M);let C;!function(e){e[e.InvalidActionType=0]="InvalidActionType",e[e.MissingPayload=1]="MissingPayload",e[e.InvalidRequestType=2]="InvalidRequestType",e[e.InvalidData=3]="InvalidData"}(C||(C={}));class w{constructor(e,t){this.type=e,this.message=t}}function x(e){return 0===e.reduce(((e,t)=>e+t.items.length),0)}function A(e){const{disableBlockActions:t,disableCommentAction:i,disableMentionAction:n,selectedMenuType:o,disableInsertBlockAction:s,disableTurnIntoAction:r,disableTextFormatting:a,disableDeleteBlock:l,accessibilityTexts:c}=e;return{id:"mab.buttonSection.main",buttons:[y("mab.button.insert","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"plus",localImageIdentifier:"insertBlock"},accessibilityText:c.insert,disabled:t||s,selected:"insertBlock"===o},apiRequestValue:{menuType:"insertBlock"}}),y("mab.button.turnInto","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.2.squarepath",localImageIdentifier:"turnInto"},disabled:t||r,selected:"turnInto"===o,accessibilityText:c.turnInto},apiRequestValue:{menuType:"turnInto"}}),y("mab.button.filePicker","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"photo.on.rectangle.angled",localImageIdentifier:"filePicker"},disabled:t,accessibilityText:c.filePicker},apiRequestValue:{jsonPayload:k("blockAction",{action:"filePicker"})}}),y("mab.button.mention","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"at",localImageIdentifier:"mention"},disabled:n,accessibilityText:c.mention},apiRequestValue:{jsonPayload:k("blockAction",{action:"mention"})}}),y("mab.button.comment","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bubble.left",localImageIdentifier:"comment"},disabled:i,accessibilityText:c.comment},apiRequestValue:{jsonPayload:k("blockAction",{action:"comment"})}}),y("bold.italic.underline","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"bold.italic.underline",localImageIdentifier:"boldItalicUnderline"},disabled:a,accessibilityText:c.textFormatting},apiRequestValue:{subMenuType:"textFormatting"}}),y("mab.button.delete","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"trash",localImageIdentifier:"trash"},disabled:l,accessibilityText:c.trash},apiRequestValue:{jsonPayload:k("blockAction",{action:"trash"})}})]}}function B(e){return[y("mab.button.moveUp","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.up.to.line.alt",localImageIdentifier:"moveUp"},accessibilityText:e.accessibilityTexts.moveUp,disabled:e.disableBlockActions},apiRequestValue:{jsonPayload:k("blockAction",{action:"moveUp"})}}),y("mab.button.moveDown","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.down.to.line.alt",localImageIdentifier:"moveDown"},accessibilityText:e.accessibilityTexts.moveDown,disabled:e.disableBlockActions},apiRequestValue:{jsonPayload:k("blockAction",{action:"moveDown"})}})]}function I(e){const{id:t,disableBlockActions:i,disableIndent:n,disableUnindent:o,shouldFadeIn:s,includeUpAndDown:r,accessibilityTexts:a}=e;if(!(i||n&&o)){var l={id:t,shouldFadeIn:s,buttons:[y("mab.button.indent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"decrease.indent",localImageIdentifier:"unindent"},accessibilityText:a.dedent,disabled:i||o},apiRequestValue:{jsonPayload:k("blockAction",{action:"unindent"})}}),y("mab.button.unindent","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"increase.indent",localImageIdentifier:"indent"},accessibilityText:a.indent,disabled:i||n},apiRequestValue:{jsonPayload:k("blockAction",{action:"indent"})}})]};if(r){var c=B({disableBlockActions:i,accessibilityTexts:{moveUp:a.moveUp,moveDown:a.moveDown}});l.buttons=l.buttons.concat(c)}return l}}function Z(e){const{disableUndo:t,disableRedo:i,disableTextActions:n,disableTextColorAction:o,textColorImageReference:s,selectedMenuType:r,accessibilityTexts:a}=e;return{id:"mab.buttonSection.block",buttons:[y("mab.button.undo","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.uturn.backward",localImageIdentifier:"undo"},accessibilityText:a.undo,disabled:t},apiRequestValue:{jsonPayload:k("blockAction",{action:"undo"})}}),y("mab.button.redo","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"arrow.uturn.forward",localImageIdentifier:"redo"},accessibilityText:a.redo,disabled:i},apiRequestValue:{jsonPayload:k("blockAction",{action:"redo"})}}),y("mab.button.textColor.native","nativeAction_setMenuType",{content:{type:"icon",imageReference:s,disabled:n||o,selected:"textColor"===r,accessibilityText:a.blockColor},apiRequestValue:{menuType:"textColor"}}),y("mab.button.more","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"ellipsis",localImageIdentifier:"more"},accessibilityText:a.more},apiRequestValue:{jsonPayload:k("blockAction",{action:"more"})}})]}}var P=i(67074),R=i(27724);function F(e){const{disableTextActions:t,boldSelected:i,italicSelected:n,underlineSelected:o,strikeSelected:s,codeSelected:r,linkSelected:a,equationSelected:l,selectedMenuType:c,disableTextColorAction:d,disableCommentAction:h,disableLinkAction:u,disableEquationAction:m,textColorImageReference:p,accessibilityTexts:b}=e;return{id:"mab.buttonSection.textFormatting",shouldFadeIn:!0,buttons:[y("mab.button.back","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.backward.2",localImageIdentifier:"back"},accessibilityText:b.close},apiRequestValue:{subMenuType:null}}),y("mab.button.bold","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bold",localImageIdentifier:"bold"},accessibilityText:b.bold,disabled:t,selected:i},apiRequestValue:{jsonPayload:k("blockAction",{action:"bold"})}}),y("mab.button.italic","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"italic",localImageIdentifier:"italic"},disabled:t,selected:n,accessibilityText:b.italics},apiRequestValue:{jsonPayload:k("blockAction",{action:"italic"})}}),y("mab.button.underline","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"underline",localImageIdentifier:"underline"},disabled:t,selected:o,accessibilityText:b.underline},apiRequestValue:{jsonPayload:k("blockAction",{action:"underline"})}}),y("mab.button.strikethrough","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"strikethrough",localImageIdentifier:"strikethrough"},disabled:t,selected:s,accessibilityText:b.strikethrough},apiRequestValue:{jsonPayload:k("blockAction",{action:"strikethrough"})}}),y("mab.button.textFormatting.textSelectionColor.native","nativeAction_setMenuType",{content:{type:"icon",imageReference:p,disabled:t||d,selected:"textSelectionColor"===c,accessibilityText:b.textColor},apiRequestValue:{menuType:"textSelectionColor"}}),y("mab.button.textFormatting.comment","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"bubble.left",localImageIdentifier:"comment"},disabled:t||h,accessibilityText:b.comment},apiRequestValue:{jsonPayload:k("blockAction",{action:"comment"})}}),y("mab.button.link","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"link",localImageIdentifier:"link"},accessibilityText:b.link,disabled:t||u,selected:a},apiRequestValue:{jsonPayload:k("blockAction",{action:"link"})}}),y("mab.button.code","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"chevron.left.slash.chevron.right",localImageIdentifier:"code"},accessibilityText:b.code,disabled:t,selected:r},apiRequestValue:{jsonPayload:k("blockAction",{action:"code"})}}),y("mab.button.equation","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"x.squareroot",localImageIdentifier:"equation"},accessibilityText:b.equation,disabled:t||m,selected:l},apiRequestValue:{jsonPayload:k("blockAction",{action:"equation"})}}),y("mab.button.cancel","nativeAction_setSubMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"xmark.circle.fill",localImageIdentifier:"cancel",imageTintColor:"#72706B64"},accessibilityText:b.close},apiRequestValue:{subMenuType:null}})]}}var O=i(17215),D=i(44886),N=i(55332),U=i(89086),L=i(70203),_=i(24677),q=i(98104),V=i(8848),W=i(7313),E=i(33929),z=i(95477),G=i(68204),j=i(47853),Q=i(25666);function K(e){const{type:t,actionSections:i,closeParentMenu:n,context:o}=e,s={},r=[];for(const a of i){const e={id:"".concat(a.key),title:a.title,items:a.actions.map((e=>{const i="".concat(e.key,"-").concat(e.displayName||""),r=e.nativeRender&&e.nativeRender(o),a=null!=r&&r.thumbnail?(0,j.D)(null==r?void 0:r.thumbnail):Q.T;return s[i]={...e,thumbnail:a,closeParentMenu:n},{id:i,title:e.displayName||"",icon:{...r,remoteImageUrl:a?"".concat(z.default.domainBaseUrl).concat(a):void 0,localAssetBundleImagePath:a},action:f("webAction_genericAction",{menuType:t,actionId:i}),checked:!1}}))};r.push(e)}return{actions:s,sections:r}}function Y(e){const{key:t,displayName:i,thumbnail:n,analyticsName:o,closeParentMenu:s,action:r}=e,a=i?E.default.formatMessage(i):void 0,l=i,c=l?"".concat(E.default.formatMessage(l)," ").concat(l.defaultMessage):void 0;return{key:"action ".concat(t),displayName:a,thumbnail:n,analyticsName:o||"textformatting_action_".concat(t),searchName:c,validators:[],action:r,closeParentMenu:Boolean(s)}}const H={bold:Y({key:"bold",closeParentMenu:!1,action:({environment:e})=>{P.pk(e,["b"])}}),italic:Y({key:"italic",closeParentMenu:!1,action:({environment:e})=>{P.pk(e,["i"])}}),underline:Y({key:"underline",closeParentMenu:!1,action:({environment:e})=>{P.pk(e,["_"])}}),strikethrough:Y({key:"strikethrough",closeParentMenu:!1,action:({environment:e})=>{P.pk(e,["s"])}}),code:Y({key:"code",closeParentMenu:!1,action:({environment:e})=>{P.pk(e,["c"])}}),comment:Y({key:"comment",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),P.ol(e,!0)}}),equation:Y({key:"equation",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),P._W(e)}}),filePicker:Y({key:"filePicker",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),P.vs(e)}}),indent:Y({key:"indent",closeParentMenu:!1,action:({environment:e})=>{P.O2(e)}}),unindent:Y({key:"unindent",closeParentMenu:!1,action:({environment:e})=>{P.$$(e)}}),moveDown:Y({key:"moveDown",closeParentMenu:!1,action:({environment:e})=>{P.rZ(e)}}),moveUp:Y({key:"moveUp",closeParentMenu:!1,action:({environment:e})=>{P.s0(e)}}),undo:Y({key:"undo",closeParentMenu:!1,action:({environment:e})=>{P.i2(e)}}),redo:Y({key:"redo",closeParentMenu:!1,action:({environment:e})=>{P.GH(e)}}),trash:Y({key:"trash",closeParentMenu:!1,action:({environment:e})=>{P.fn(e)}}),mention:Y({key:"mention",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),P.Z3(e)}}),link:Y({key:"link",closeParentMenu:!0,action:async({environment:e})=>{var t;await(null===(t=e.NativeMobileActionBarStore)||void 0===t?void 0:t.clearNativeActionMenuAndRestoreSelectionIfNecessary()),P.UF(e)}}),more:Y({key:"more",closeParentMenu:!1,action:({environment:e})=>{P.w1(e,void 0,void 0)}}),dismissKeyboard:Y({key:"dismissKeyboard",closeParentMenu:!0,action:({environment:e})=>{}})};var J=i(27832),X=i(24666),$=i(68056),ee=i(45162),te=i(28020);const ie=(0,p.defineMessages)({templatesButtonTitle:{defaultMessage:"Choose a template...",id:"mobileActionBar.templateButtonTitle"},actionMenuInsertBlockTitle:{defaultMessage:"Insert Block",id:"mobileActionBar.actionMenuTitle.insertBlock"},actionMenuTurnIntoTitle:{defaultMessage:"Turn Into",id:"mobileActionBar.actionMenuTitle.turnInto"},actionMenuColorTitle:{defaultMessage:"Color",id:"mobileActionBar.actionMenuTitle.blockColor"},accessibilityInsert:{defaultMessage:"Add block",id:"mobileActionBar.accessibility.insertBlock",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTurnInto:{defaultMessage:"Turn into block",id:"mobileActionBar.accessibility.turnInto",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityFilePicker:{defaultMessage:"Add image",id:"mobileActionBar.accessibility.filePicker",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMention:{defaultMessage:"Add mention",id:"mobileActionBar.accessibility.mention",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityBlockColor:{defaultMessage:"Change block color",id:"mobileActionBar.accessibility.blockColor",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTextFormatting:{defaultMessage:"Open text formatting menu",id:"mobileActionBar.accessibility.textFormatting",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityComment:{defaultMessage:"Add comment",id:"mobileActionBar.accessibility.comment",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTrash:{defaultMessage:"Delete block",id:"mobileActionBar.accessibility.trash",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityIndent:{defaultMessage:"Indent block",id:"mobileActionBar.accessibility.indent",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityDedent:{defaultMessage:"Unindent block",id:"mobileActionBar.accessibility.unindent",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMoveUp:{defaultMessage:"Move a block up",id:"mobileActionBar.accessibility.moveUp",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMoveDown:{defaultMessage:"Move a block down",id:"mobileActionBar.accessibility.moveDown",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityUndo:{defaultMessage:"Undo edit",id:"mobileActionBar.accessibility.udno",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityRedo:{defaultMessage:"Redo edit",id:"mobileActionBar.accessibility.redo",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityMore:{defaultMessage:"More block actions",id:"mobileActionBar.accessibility.more",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityBold:{defaultMessage:"Bold",id:"mobileActionBar.accessibility.bold",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityItalics:{defaultMessage:"Italicize",id:"mobileActionBar.accessibility.italics",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityUnderline:{defaultMessage:"Underline",id:"mobileActionBar.accessibility.underline",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityStrikethrough:{defaultMessage:"Strikethrough",id:"mobileActionBar.accessibility.strikethrough",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityTextColor:{defaultMessage:"Text color",id:"mobileActionBar.accessibility.textColor",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityCode:{defaultMessage:"Code",id:"mobileActionBar.accessibility.code",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityLink:{defaultMessage:"Add link",id:"mobileActionBar.accessibility.link",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityEquation:{defaultMessage:"Add equation",id:"mobileActionBar.accessibility.equation",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityCloseTextFormattingMenu:{defaultMessage:"Close text formatting menu",id:"mobileActionBar.accessibility.close",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityDismissKeyboard:{defaultMessage:"End editing",id:"mobileActionBar.accessibility.endEditing",description:"Accessibility text, this will be read aloud by the screen reader"},accessibilityCloseActionMenu:{defaultMessage:"Close menu",id:"mobileActionBar.accessibility.closeMenu",description:"Accessibility text, this will be read aloud by the screen reader"}}),ne={text:!1,to_do:!0,bulleted_list:!0,numbered_list:!0,toggle:!0,column:!1,transclusion_container:!1,callout:!1,quote:!1};function oe(e){var t;const{onAction:i,fallbackRenderer:n,...o}=e,s=u(null===(t=(0,a.O7)().mobileNative)||void 0===t?void 0:t.api.renderMobileActionBar,o);return function(e,t,i,n){var o;const s=null===(o=(0,a.O7)().mobileNative)||void 0===o?void 0:o.componentEvents;(0,d.useEffect)((()=>{if(s&&n&&t)return s.addListener(e,t,i,n)}),[e,t,i,n,s])}("MobileActionBar",s,"onAction",i),!s&&n?h().createElement(h().Fragment,null,n()):null}class se extends m.Z{constructor(...e){super(...e),r()(this,"handleTextSelectionCompositeStoreChanged",(()=>{if(!this.textSelectionCompositeStore.state)return;const{source:e}=this.textSelectionCompositeStore.state,{NativeMobileActionBarStore:t,device:i}=this.environment;"TextSelectionStore"!==e||null===(null==t?void 0:t.state.menuType)||i.isTablet||this.setCurrentMenuType(null,!0)})),r()(this,"handleTextSelectionStoreChanged",(()=>{if(!this.textSelectionPositionsStore.state)return;const{NativeMobileActionBarStore:e}=this.environment;e&&null===e.state.subMenuType&&e.state.isSubMenuOverridden&&this.setCurrentSubMenuType(null,!1)})),r()(this,"getCurrentActionBarSchema",this.createComputedStore((()=>{const{NativeMobileActionBarStore:e}=this.environment,t=Boolean(this.renderStore.state.disableAnnotation),i=e?e.state.menuType:null;var n=null;const o=P.Tz({environment:this.environment,store:this.props.currentBlockStore}),s=!!e&&e.state.isSubMenuOverridden,r=this.shouldShowTextActions.state,a=e?e.state.subMenuType:null;s?n=a:r&&!t&&(n="textFormatting",null==e||e.update((e=>({...e,isSubMenuOverridden:!1,subMenuType:null}))));const l="editing"===X.default.state.mode&&X.default.state.multiSelection,c=this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState,d=c&&"editing"===c.mode&&c.multiSelection,h=l||d,u=Boolean(h&&(0,$.qS)(h)),m=!this.canTriggerTextActions.state,p=!this.canTriggerBlockActions.state,b=this.props.currentBlockStore.getValue(),g=this.commentActionDisabled(b)||Boolean(this.renderStore.state.disableComment),v=this.mentionActionDisabled(b),S=R.default.state.stores,f=!S.every(D.nt),M=!S.every(D.gq),T=!N.L0(),C=!N.AZ(),w=(0,te.JE)(),O=this.memoizedNativeMenus({environment:this.environment,blocks:R.default.state.stores}),U=x(O.textColor.sections);var L,_,q;if(o)L=[(q=E.default.formatMessage(ie.templatesButtonTitle),{id:"mab.buttonSection.template",buttons:[y("mab.button.choose_template","webAction_generic",{content:{type:"text_and_icon",imageReference:{localImageIdentifier:"template"},text:q},apiRequestValue:{jsonPayload:k("showActionBarMenu",{actionBarMenuId:"template"})}})]})];else{var V;const e={main:A({disableBlockActions:p,disableCommentAction:g,disableMentionAction:v,selectedMenuType:i,disableInsertBlockAction:x(O.insertBlock.sections),disableTurnIntoAction:x(O.turnInto.sections),disableTextFormatting:t,disableDeleteBlock:w,accessibilityTexts:{insert:E.default.formatMessage(ie.accessibilityInsert),turnInto:E.default.formatMessage(ie.accessibilityTurnInto),filePicker:E.default.formatMessage(ie.accessibilityFilePicker),mention:E.default.formatMessage(ie.accessibilityMention),comment:E.default.formatMessage(ie.accessibilityComment),textFormatting:E.default.formatMessage(ie.accessibilityTextFormatting),trash:E.default.formatMessage(ie.accessibilityTrash)}}),listPrioritized:I({id:"mab.list.prioritized",disableBlockActions:p,disableIndent:f,disableUnindent:M,shouldFadeIn:!1,includeUpAndDown:!1,accessibilityTexts:{indent:E.default.formatMessage(ie.accessibilityIndent),dedent:E.default.formatMessage(ie.accessibilityDedent),moveUp:E.default.formatMessage(ie.accessibilityMoveUp),moveDown:E.default.formatMessage(ie.accessibilityMoveDown)}}),listDeprioritized:I({id:"mab.list.deprioritized",disableBlockActions:p,disableIndent:f,disableUnindent:M,shouldFadeIn:!0,includeUpAndDown:!0,accessibilityTexts:{indent:E.default.formatMessage(ie.accessibilityIndent),dedent:E.default.formatMessage(ie.accessibilityDedent),moveUp:E.default.formatMessage(ie.accessibilityMoveUp),moveDown:E.default.formatMessage(ie.accessibilityMoveDown)}}),block:Z({disableUndo:T,disableRedo:C,textColorImageReference:this.textColorImageReference(),disableTextActions:m,disableTextColorAction:U,selectedMenuType:i,accessibilityTexts:{undo:E.default.formatMessage(ie.accessibilityUndo),redo:E.default.formatMessage(ie.accessibilityRedo),blockColor:E.default.formatMessage(ie.accessibilityBlockColor),more:E.default.formatMessage(ie.accessibilityMore)}}),moveUpAndDown:(_={disableBlockActions:p,accessibilityTexts:{moveUp:E.default.formatMessage(ie.accessibilityMoveUp),moveDown:E.default.formatMessage(ie.accessibilityMoveDown)}},{id:"mab.buttonSection.last",shouldFadeIn:!0,buttons:B(_)})},n=h&&(null===(V=(0,ee.tp)({multiSelection:h,focus:void 0,filterCommonAncestors:!1}))||void 0===V?void 0:V.stores),o=n&&n.some((e=>{const t=e.getType();return t&&ne[t]}));L=e.listPrioritized&&o?[e.listPrioritized,e.main,e.block,e.moveUpAndDown]:e.listDeprioritized&&n&&n.every((e=>D.nt(e)||D.gq(e)))?[e.main,e.block,e.listDeprioritized]:w?[e.main,e.block]:[e.main,e.block,e.moveUpAndDown]}const W=[F({disableTextActions:m,disableCommentAction:g,disableLinkAction:!u,disableEquationAction:!u,selectedMenuType:i,disableTextColorAction:U,textColorImageReference:this.textSelectionColorImageReference(),accessibilityTexts:{bold:E.default.formatMessage(ie.accessibilityBold),italics:E.default.formatMessage(ie.accessibilityItalics),underline:E.default.formatMessage(ie.accessibilityUnderline),strikethrough:E.default.formatMessage(ie.accessibilityStrikethrough),textColor:E.default.formatMessage(ie.accessibilityTextColor),comment:E.default.formatMessage(ie.accessibilityComment),code:E.default.formatMessage(ie.accessibilityCode),link:E.default.formatMessage(ie.accessibilityLink),equation:E.default.formatMessage(ie.accessibilityEquation),close:E.default.formatMessage(ie.accessibilityCloseTextFormattingMenu)},...this.getTextFormattingSelections()})];return function(e){const{selectedMenu:t,selectedSubMenu:i,nativeMenus:n,buttonSections:o,nativeSubMenus:s,accessibilityTexts:r}=e;return{nativeMenus:n,nativeSubMenus:s,state:{buttonSections:o,selectedMenu:t,selectedSubMenu:i,dismissKeyboardButton:null!==t?y("mab.dismissKeyboard","nativeAction_setMenuType",{content:{type:"icon",imageReference:{sfProGlyphName:"xmark.circle.fill",localImageIdentifier:"cancel",imageTintColor:"#72706B64"},accessibilityText:r.closeActionMenu},apiRequestValue:{menuType:null}}):y("mab.dismissKeyboard","webAction_generic",{content:{type:"icon",imageReference:{sfProGlyphName:"keyboard.chevron.compact.down",localImageIdentifier:"keyboardDown"},accessibilityText:r.dismissKeyboard},apiRequestValue:{jsonPayload:k("blockAction",{action:"dismissKeyboard"})}}),mutatedNativeMenus:{},localizedMessages:{}}}}({selectedMenu:i,selectedSubMenu:n,nativeMenus:{textColor:{id:"textColor",title:E.default.formatMessage(ie.actionMenuColorTitle),sections:O.textColor.sections},textSelectionColor:{id:"textSelectionColor",title:E.default.formatMessage(ie.actionMenuColorTitle),sections:O.textSelectionColor.sections},insertBlock:{id:"insertBlock",title:E.default.formatMessage(ie.actionMenuInsertBlockTitle),sections:O.insertBlock.sections},turnInto:{id:"turnInto",title:E.default.formatMessage(ie.actionMenuTurnIntoTitle),sections:O.turnInto.sections}},nativeSubMenus:{textFormatting:W},buttonSections:L,accessibilityTexts:{dismissKeyboard:E.default.formatMessage(ie.accessibilityDismissKeyboard),closeActionMenu:E.default.formatMessage(ie.accessibilityCloseActionMenu)}})}))),r()(this,"textSelectionPositionsStore",this.createComputedStore((()=>{const e=this.textSelectionCompositeStore.state;if(!e)return;const{source:t,...i}=e;return i}),!0)),r()(this,"textSelectionCompositeStore",this.createComputedStore((()=>{const e=(e,t)=>{if(!e||"editing"!==e.mode)return;const{multiSelection:i}=e;return{startRecord:i.start.store.pointer,startIndex:i.start.index,endRecord:i.end.store.pointer,endIndex:i.end.index,source:t}};return e(X.default.state,"TextSelectionStore")||e(this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState,"IgnoreSelectionAreaStore")}),!0)),r()(this,"renderStore",this.createComputedStore((()=>{var e;const t=P.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state);if(!t){const e=this.environment.NativeMobileActionBarStore;null!==(null==e?void 0:e.state.menuType)&&c().delay((()=>{var e;P.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)||this.setCurrentMenuType(null,!1)}),500),null!==(null==e?void 0:e.state.subMenuType)&&c().delay((()=>{var e;P.$3(this.environment,this.props.currentBlockStore,null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state)||this.setCurrentSubMenuType(null,!1)}),500)}return t}))),r()(this,"shouldShowTextActions",this.createComputedStore((()=>P.oQ(this.props.stores.ignoreSelectionAreaStore)))),r()(this,"canTriggerBlockActions",this.createComputedStore((()=>P.Bo(this.pageContext&&this.pageContext.publicEditModeStore.state)))),r()(this,"canTriggerTextActions",this.createComputedStore((()=>P.eQ(this.pageContext&&this.pageContext.publicEditModeStore.state,this.props.currentBlockStore)))),r()(this,"memoizedNativeMenus",c().memoize((e=>{const{blocks:t,environment:i}=e;return n={environment:i,blocks:t},{insertBlock:K({type:"insertBlock",actionSections:G.L1(W.kR,n),context:n,closeParentMenu:!0}),turnInto:K({type:"turnInto",actionSections:G.L1([W.gH],n),context:n,closeParentMenu:!0}),textColor:K({type:"textColor",actionSections:G.L1([W.rz,W.Vm],n),context:n,closeParentMenu:!1}),textSelectionColor:K({type:"textSelectionColor",actionSections:G.L1([W.b4,W.Sw],n),context:n,closeParentMenu:!1})};var n})))}didMount(){this.textSelectionCompositeStore.addListener(this.handleTextSelectionCompositeStoreChanged),this.textSelectionPositionsStore.addListener(this.handleTextSelectionStoreChanged)}willUnmount(){this.textSelectionCompositeStore.removeListener(this.handleTextSelectionCompositeStoreChanged),this.textSelectionPositionsStore.removeListener(this.handleTextSelectionStoreChanged),this.props.renderApi&&this.props.renderApi({type:"unmount",id:""})}renderComponent(){return o()(oe,{isOpen:this.renderStore.state.shouldShow,canShow:this.renderStore.state.canShowNativeBar,schema:this.getCurrentActionBarSchema.state,onAction:e=>{const{action:t}=e;switch(t.type){case"nativeAction_hideKeyboard":break;case"nativeAction_setMenuType":this.handleSetMenuTypeAction(t);break;case"nativeAction_setSubMenuType":this.handleSetSubMenuTypeAction(t);break;case"webAction_generic":this.handleGenericWebAction(t);break;case"webAction_genericAction":this.handleActionRegistryAction(t)}},fallbackRenderer:this.props.fallbackRenderer})}commentActionDisabled(e){return!(!e||!(0,O._T)(e))}mentionActionDisabled(e){return!(!e||!(0,O.lQ)(e))}handleSetMenuTypeAction(e){const t=function(e){if("nativeAction_setMenuType"!==e.type)return new w(C.InvalidActionType,void 0);const t=e.apiRequestValue;if(!t||!("menuType"in t))return new w(C.MissingPayload,void 0);const i=b.Ry({required:{menuType:b.eR(...v,null)},optional:{}}),n=(0,g.Gu)(i,t);return n?new w(C.InvalidRequestType,JSON.stringify(n)):t.menuType}(e);if(t instanceof w)return void console.error(JSON.stringify(t));if((this.environment.NativeMobileActionBarStore?this.environment.NativeMobileActionBarStore.state.menuType:null)===t)this.setCurrentMenuType(null,!0);else switch(this.setCurrentMenuType(t,!0),t){case"insertBlock":P.Oh(this.environment,"insert");break;case"turnInto":P.Oh(this.environment,"turn_into");break;case"textColor":case"textSelectionColor":P.Oh(this.environment,"color")}}handleSetSubMenuTypeAction(e){const t=function(e){if("nativeAction_setSubMenuType"!==e.type)return new w(C.InvalidActionType,void 0);const t=e.apiRequestValue;if(!t||!("subMenuType"in t))return new w(C.MissingPayload,void 0);const i=b.Ry({required:{subMenuType:b.eR(...S,null)},optional:{}}),n=(0,g.Gu)(i,t);return n?new w(C.InvalidRequestType,JSON.stringify(n)):t.subMenuType}(e);t instanceof w?console.error(JSON.stringify(t)):this.setCurrentSubMenuType(t,!0)}handleGenericWebAction(e){const t=function(e){if("webAction_generic"!==e.type)return new w(C.InvalidActionType,void 0);const t=e.apiRequestValue;if(!t||!("jsonPayload"in t))return new w(C.MissingPayload,void 0);const i=JSON.parse(t.jsonPayload),n=b.Ry({required:{type:b.eR(...T)},optional:{}}),o=(0,g.Gu)(n,i);if(o)return new w(C.InvalidRequestType,JSON.stringify(o));const s=i,r=M[s.type],a=(0,g.Gu)(r,s);return a?new w(C.InvalidData,JSON.stringify(a)):s}(e);if(t instanceof w)console.error(JSON.stringify(t));else switch(t.type){case"blockAction":if("dismissKeyboard"===t.data.action){this.handleDismissKeyboard();break}const e=H[t.data.action];if(!e)break;const i=e.action;if(i){const{currentBlockStore:t}=J.default.state;if(!t)break;const{device:n}=this.environment;e.closeParentMenu&&!n.isTablet&&this.setCurrentMenuType(null,!0),i({environment:this.environment,blocks:[t]})}break;case"showActionBarMenu":switch(t.data.actionBarMenuId){case"insertBlock":this.handleInsert();break;case"textColor":this.handleTextColor();break;case"turnInto":this.handleTurnInto();break;case"template":this.handleTemplate()}}}handleActionRegistryAction(e){var t,i;const n=null===(t=e.apiRequestValue)||void 0===t?void 0:t.menuType,o=null===(i=e.apiRequestValue)||void 0===i?void 0:i.actionId;if(!n||!o)return;const s=this.memoizedNativeMenus({environment:this.environment,blocks:R.default.state.stores})[n].actions[o];if(!s)return;const r=s.action;r&&(s.closeParentMenu&&this.setCurrentMenuType(null,!0),r({environment:this.environment,blocks:R.default.state.stores}))}handleDismissKeyboard(){_.ZH(this.environment),this.props.stores.store.update((e=>({...e,isInsertOpen:!1}))),this.setCurrentMenuType(null,!1),this.setCurrentSubMenuType(null,!1),P.Oh(this.environment,"hide_keyboard"),q.sD()}getTextFormattingSelections(){return{boldSelected:Boolean((0,U.Ld)(L.GK.Bold)),italicSelected:Boolean((0,U.Ld)(L.GK.Italic)),underlineSelected:Boolean((0,U.Ld)(L.GK.Underline)),strikeSelected:Boolean((0,U.Ld)(L.GK.Strike)),codeSelected:Boolean((0,U.Ld)(L.GK.Code)),linkSelected:Boolean((0,U.Ld)(L.GK.Link)),equationSelected:Boolean((0,U.Ld)(L.GK.Equation))}}imageReferenceForBlockColor(e){let t="textColor";const i=Object.keys(this.theme.blockColors).find((t=>t===e));let n;"default"===e||i&&(i.includes("background")?(n="background",t="textBackgroundColor"):n="color");const o=n&&i?this.theme.blockColors[i][n]:void 0;return{localImageIdentifier:t,imageTintColor:o?(0,V.J1)(o):void 0}}textSelectionColorImageReference(){const{NativeMobileActionBarStore:e}=this.environment,t=e&&null!==e.state.menuType?this.props.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState:void 0,i=(0,U.a6)("h",t||X.default.state),n=i?(0,L.zI)(i):void 0;return this.imageReferenceForBlockColor(n)}textColorImageReference(){const e=R.default.state.stores.length>0?R.default.state.stores[0].getFormat().block_color:void 0;return this.imageReferenceForBlockColor(e)}handleInsert(){this.props.stores.store.update((e=>({...e,isInsertOpen:!0}))),P.Oh(this.environment,"insert")}handleTurnInto(){this.props.stores.store.update((e=>({...e,isTurnIntoOpen:!0}))),P.Oh(this.environment,"turn_into")}handleTemplate(){this.props.stores.store.update((e=>({...e,isTemplatesOpen:!0}))),P.Oh(this.environment,"templates")}handleTextColor(){this.props.stores.store.update((e=>({...e,isColorOpen:!0}))),P.Oh(this.environment,"color")}setCurrentMenuType(e,t){var i;null===(i=this.environment.NativeMobileActionBarStore)||void 0===i||i.update((i=>({...i,menuType:e,shouldRestoreSelectionForMenu:t})))}setCurrentSubMenuType(e,t){const{NativeMobileActionBarStore:i}=this.environment;null==i||i.update((i=>({...i,isSubMenuOverridden:t,subMenuType:e})))}}const re=(0,p.injectIntl)(se)},72653:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(59488),o=i(49164),s=i(69454),r=i(55320);const a=new o.Z((()=>{const{phase:e}=s.Z.state;if(r.default.state.open)return!0;return(0,n.de)()||e===s.i.hidden||e===s.i.willHide}))}}]);